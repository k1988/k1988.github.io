<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>k1988</title>
  
  <link href="/rss.xml" rel="self"/>
  
  <link href="http://baba.zhaoxiuyuan.com/"/>
  <updated>2017-08-18T07:16:54.336Z</updated>
  <id>http://baba.zhaoxiuyuan.com/</id>
  
  <author>
    <name>赵海洋</name>
    <email>zhaohaiyang_1988@163.com</email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Android NDK 知识大全</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/08/120_redefine_so_dynamic_symbols/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/08/120_redefine_so_dynamic_symbols/</id>
    <published>2017-08-18T07:12:28.000Z</published>
    <updated>2017-08-18T07:16:54.336Z</updated>
    
    <content type="html">&lt;h1 id=&quot;引用&quot;&gt;&lt;a href=&quot;#引用&quot; class=&quot;headerlink&quot; title=&quot;引用&quot;&gt;&lt;/a&gt;引用&lt;/h1&gt;&lt;h2 id=&quot;基本概念&quot;&gt;&lt;a href=&quot;#基本概念&quot; class=&quot;headerlink&quot; title=&quot;基本概念&quot;&gt;&lt;/a&gt;基本概念&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/concepts.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android官方文档-概念&lt;/a&gt;，从这里可以发散出JNI、ABI等需要学习的概念，按文档学习即可&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Gradle插件节点定义&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;NDK安装配置&quot;&gt;&lt;a href=&quot;#NDK安装配置&quot; class=&quot;headerlink&quot; title=&quot;NDK安装配置&quot;&gt;&lt;/a&gt;NDK安装配置&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android官方指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/9aff422204eb&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Studio里NDK入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/zhaoguangjun33/article/details/51690136&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Studio下使用NDK&lt;/a&gt;,这里提供了一些gradle里直接设置toolchain,CFlags等的示例&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;编译选项&quot;&gt;&lt;a href=&quot;#编译选项&quot; class=&quot;headerlink&quot; title=&quot;编译选项&quot;&gt;&lt;/a&gt;编译选项&lt;/h2&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/crash163/article/details/52228412&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android NDK编译选项设置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/wchinaw/article/details/19621285&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NDK中C++标准库、STL的配置；Include其他头文件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/d9e9ba3312fc&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Studio中对NDK进行设置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/android_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android官方指南之Androd.mk&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/application_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android官方指南之Androd.mk&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;资料整理&quot;&gt;&lt;a href=&quot;#资料整理&quot; class=&quot;headerlink&quot; title=&quot;资料整理&quot;&gt;&lt;/a&gt;资料整理&lt;/h1&gt;&lt;p&gt;无论是用Android Studio集成NDK，还是手动使用NDK命令行，有两个文件是必须的&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/android_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android.mk&lt;/a&gt;: 在jni文件夹内必须创建这个文件，ndk-build命令也会首先查找此文件才能执行，文件里定义ndk编译的模块的名称、c/c++源代码，需要链接的库及构建选项（传递给编译工具gcc|clang等的参数）。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/application_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Application.mk&lt;/a&gt;: 这个文件定义需要构建的模块和构建环境及工具，包括以下：&lt;ul&gt;
&lt;li&gt;需要编译的目标平台&lt;a href=&quot;https://developer.android.com/ndk/guides/abis.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ABI&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;工具链接&lt;/li&gt;
&lt;li&gt;需要包含的标准库(static and dynamic STLport or default system).&lt;/li&gt;
&lt;li&gt;全局的编译选项&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;Android-mk&quot;&gt;&lt;a href=&quot;#Android-mk&quot; class=&quot;headerlink&quot; title=&quot;Android.mk&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/android_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android.mk&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;示例：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;LOCAL_PATH := $(call my-dir) # 必须要使用这个开头&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;include $(CLEAR_VARS)  # 必须，清除编译环境中所有的LOCAL变量，否则同时编译多个Module时不同的Android.mk里的LOCAL变量会相互影响&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOCAL_MODULE    := mcpelauncher # 必须，定义模块名称&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 必须，源文件文件列表&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOCAL_SRC_FILES := nativepatch.c modscript.c modscript_nextgen.cpp modscript_ScriptLevelListener.cpp utf8proc_slim.c dobby.cpp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOCAL_C_INCLUDES += E:\C_Shared\sdk\ndk-bundle\platforms\android-14\arch-arm\usr\include\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOCAL_LDLIBS := -llog   # 需要链接的NDK库&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOCAL_SHARED_LIBRARIES := tinysubstrate-bin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 必须，包含定义好的一个文件，获取抽有LOCAL变量并决定构建信息&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;include $(BUILD_SHARED_LIBRARY)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$(call import-add-path, prebuilts) # 其它导入模块&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$(call import-module, tinysubstrate-bin)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;变量和宏&quot;&gt;&lt;a href=&quot;#变量和宏&quot; class=&quot;headerlink&quot; title=&quot;变量和宏&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/android_mk.html#var&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;变量和宏&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;命名规则：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LOCAL_： NDK编译系统使用的，提供给用户设置值&lt;/li&gt;
&lt;li&gt;PRIVATE&lt;em&gt;、NDK&lt;/em&gt;、APP：NDK编译系统内部使用，用户不要定义&lt;/li&gt;
&lt;li&gt;my-dir：一些小写名称，编译系统内部使用的&lt;/li&gt;
&lt;li&gt;MY_: 其它大写名称，是用户自定义（仅仅是推荐，用户可以使用其它前缀或不使用前缀）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;NDK预定义变量&quot;&gt;&lt;a href=&quot;#NDK预定义变量&quot; class=&quot;headerlink&quot; title=&quot;NDK预定义变量&quot;&gt;&lt;/a&gt;NDK预定义变量&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CLEAR_VARS&lt;/strong&gt; &lt;code&gt;include $(CLEAR_VARS)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BUILD_SHARED_LIBRARY | BUILD_STATIC_LIBRARY&lt;/strong&gt; &lt;code&gt;include $(BUILD_SHARED_LIBRARY)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PREBUILT_SHARED_LIBRARY | PREBUILT_STATIC_LIBRARY&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TARGET_ARCH&lt;/strong&gt; 目标cpu架构 取值arm、x86等&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TARGET_PLATFORM&lt;/strong&gt; 目标android版本 &lt;code&gt;TARGET_PLATFORM := android-22&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TARGET_ARCH_ABI&lt;/strong&gt; 目标cpu及架构的全名 如：&lt;code&gt;TARGET_ARCH_ABI := arm64-v8a x86&lt;/code&gt;，详表见&lt;a href=&quot;https://developer.android.com/ndk/guides/android_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;官方文档&lt;/a&gt;中TARGET_ARCH_ABI一节。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TARGET_ABI&lt;/strong&gt; Android Api级别和ABI的组合&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;模块定义变量&quot;&gt;&lt;a href=&quot;#模块定义变量&quot; class=&quot;headerlink&quot; title=&quot;模块定义变量&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/android_mk.html#mdv&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;模块定义变量&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;这些变量是每个模块单独设置的，每个模块都需要做以下事情：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;初使化模块变量或者用CLEAR_VARS清除&lt;/li&gt;
&lt;li&gt;给一些变量赋值来描述模块的功能&lt;/li&gt;
&lt;li&gt;使用NDK预定义变量中的BUILD_XXX来定义模块的格式（动态库、静态库等）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;变量列表（粗体为必须）：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;LOCAL_PATH&lt;/strong&gt; 设置当前文件的路径，必须在Androd.mk的开头使用&lt;code&gt;LOCAL_PATH := $(call my-dir)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LOCAL_MODULE&lt;/strong&gt; 当前模块名称，不能用空格。除了&lt;code&gt;CLEAR_VARS&lt;/code&gt;之外他要放在前面，不需要添加lib前缀和.so.a后缀。&lt;/li&gt;
&lt;li&gt;LOCAL_MODULE_FILENAME 模块文件名，可以指定一个新的模块文件名&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LOCAL_SRC_FILES&lt;/strong&gt; 源文件文件列表&lt;/li&gt;
&lt;li&gt;LOCAL_CPP_EXTENSION 定义支持的c++源文件的后缀，一般来说可以用&lt;code&gt;LOCAL_CPP_EXTENSION := .cxx .cpp .cc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;LOCAL_CPP_FEATURES c++语言特性，如rtti、exceptions等&lt;/li&gt;
&lt;li&gt;LOCAL_C_INCLUDES 头文件默认是相对于NDK的根目录，如果相对于当前目录要用&lt;code&gt;LOCAL_C_INCLUDES := $(LOCAL_PATH)//foo&lt;/code&gt;,需要设置在LOCAL_CFLAGS和LOCAL_CPPFLAGS &lt;strong&gt;之前&lt;/strong&gt;。ps：在windows上我想直接引用ndk目录，但使用了LOCAL_PATH后似乎就默认是当前目录了， 所以我最后使用了环境变量中的ndk目录。例：&lt;code&gt;LOCAL_C_INCLUDES += $(ANDROID_NDK_HOME)\platforms\$(TARGET_PLATFORM)\arch-$(TARGET_ARCH)\usr\include&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;LOCAL_CFLAGS 给c和c++的编译选项，从 android-ndk-1.5_r1开始，此选项仅适用于c语言&lt;/li&gt;
&lt;li&gt;LOCAL_CPPFLAGS 给c++的编译选项&lt;/li&gt;
&lt;li&gt;LOCAL_STATIC_LIBRARIES 当前模块依赖的静态库，如果当前模块也是静态库，这个表明引用当前模块的也自动依赖这些静态库。如果当前模块是可执行程序或动态库，则链接这些静态库。&lt;/li&gt;
&lt;li&gt;LOCAL_SHARED_LIBRARIES 运行时依赖的动态库，仅用在链接时&lt;/li&gt;
&lt;li&gt;LOCAL_LDLIBS 声明链接时引用的动态库,-l作为前缀，例&lt;code&gt;LOCAL_LDLIBS := -lz&lt;/code&gt;声明需要链接&lt;code&gt;/system/lib/libz.so&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;LOCAL_LDFLAGS 链接参数，如果当前模块是是静态库，此参数无效&lt;/li&gt;
&lt;li&gt;LOCAL_ALLOW_UNDEFINED_SYMBOLS 当设置成true时，链接时不检查未定义的引用。如果当前模块是是静态库，此参数无效&lt;/li&gt;
&lt;li&gt;LOCAL_WHOLE_STATIC_LIBRARIES、LOCAL_ARM_MODE、LOCAL_ARM_NEON、LOCAL_DISABLE_NO_EXECUTE、LOCAL_DISABLE_RELRO、LOCAL_DISABLE_FORMAT_STRING_CHECKS、LOCAL_SHORT_COMMANDS、LOCAL_THIN_ARCHIVE、LOCAL_FILTER_ASM等 略，详见文档&lt;/li&gt;
&lt;li&gt;LOCAL_EXPORT_XXX系列指令&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;预定义函数&quot;&gt;&lt;a href=&quot;#预定义函数&quot; class=&quot;headerlink&quot; title=&quot;预定义函数&quot;&gt;&lt;/a&gt;预定义函数&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;my-dir&lt;/strong&gt; 获取最后一个makefile的目录&lt;/li&gt;
&lt;li&gt;all-subdir-makefiles 返回所有子目录中的Android.mk&lt;/li&gt;
&lt;li&gt;this-makefile 当前makefile的路径&lt;/li&gt;
&lt;li&gt;parent-makefile 上级makefile的路径&lt;/li&gt;
&lt;li&gt;grand-parent-makefile 上上级makefile的路径&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;import-module&lt;/strong&gt; 使用方式&lt;code&gt;$(call import-module,&amp;lt;name&amp;gt;)&lt;/code&gt;,在NDK_MODULE_PATH环境变量中查找指定名称的模块，然后inlucde它的Android.mk文件&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;Application-mk&quot;&gt;&lt;a href=&quot;#Application-mk&quot; class=&quot;headerlink&quot; title=&quot;Application.mk&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/application_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Application.mk&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;示例：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;APP_ABI := x86 #只生成x86架构的CPU用的lib，要生成所有平台的可以改为all    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#APP_STL := stlport_static  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NDK_TOOLCHAIN_VERSION=4.7 #使用GCC4.7  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;APP_STL := gnustl_static #GNU STL  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;APP_CPPFLAGS := -fexceptions -frtti #允许异常功能，及运行时类型识别  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;APP_CPPFLAGS +=-std=c++11 #允许使用c++11的函数等功能  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;APP_CPPFLAGS +=-fpermissive  #此项有效时表示宽松的编译形式，比如没有用到的代码中有错误也可以通过编译；使用GNU STL时不用此项std::string 居然编译不通过！！&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;变量&quot;&gt;&lt;a href=&quot;#变量&quot; class=&quot;headerlink&quot; title=&quot;变量&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/application_mk.html#var&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;变量&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;APP_PROJECT_PATH app的根目录，如果当前Application.mk放在&lt;code&gt;$PROJECT/jni/&lt;/code&gt;下，则不需要设置此变量&lt;/li&gt;
&lt;li&gt;APP_MODULES 如果定义了此变量，则只编译指定的模块。模块名使用空格间隔&lt;/li&gt;
&lt;li&gt;APP_OPTIM release 或 debug ,默认值是release，如果在Android项目中定义了android:debuggable,，则默认是debug&lt;/li&gt;
&lt;li&gt;APP_CFLAGS 所有模块通用的c编译参数&lt;/li&gt;
&lt;li&gt;APP_CPPFLAGS 所有模块通用的c++编译参数&lt;/li&gt;
&lt;li&gt;APP_LDFLAGS 所有模块通用的链接参数&lt;/li&gt;
&lt;li&gt;APP_BUILD_SCRIPT ndk墨认在jin/下找文件Android.mk，可以使用这个变量指定编译脚本路径。&lt;/li&gt;
&lt;li&gt;APP_ABI 默认ndk生成的是armeabi，可以使用此变量来指定，例：&lt;code&gt;APP_ABI := armeabi armeabi-v7a x86 mips&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;APP_PLATFORM 指定最小支持android版本，最好不要使用此选项，而是使用模块的build.gradle中的defaultConfig 或 productFlavors 中的minSdkVersion来指定。&lt;/li&gt;
&lt;li&gt;APP_STL 默认使用系统的std库，可以使用这个指定，可选的见&lt;a href=&quot;https://developer.android.com/ndk/guides/cpp-support.html#runtimes&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;官方文档&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;NDK_TOOLCHAIN_VERSION 指定编译工具的版本，如果是&lt;code&gt;clang&lt;/code&gt;就是引用Clang编译器，如果是&lt;code&gt;4.9&lt;/code&gt;这种，就是指定GCC的版本&lt;/li&gt;
&lt;li&gt;APP_SHORT_COMMANDS、APP_PIE、APP_THIN_ARCHIVE 略过，详见文档&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;gradle配置&quot;&gt;&lt;a href=&quot;#gradle配置&quot; class=&quot;headerlink&quot; title=&quot;gradle配置&quot;&gt;&lt;/a&gt;gradle配置&lt;/h2&gt;&lt;p&gt;nkd的配置也分散在grale中&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.BaseExtension.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;android节点&lt;/a&gt;下面的各个节点中，主要在ndk，&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ExternalNativeNdkBuildOptions.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;defaultConfig.externalNativeBuild.ndkBuild&lt;/a&gt;、&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ExternalNativeBuild.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;externalNativeBuild.ndkBuild&lt;/a&gt;中，同时在sourceSets中对文件包含进行一些修改，flavor和build-types在不同的编译选项下打不同的包。&lt;/p&gt;
&lt;h3 id=&quot;android-defaultConfig-ndk&quot;&gt;&lt;a href=&quot;#android-defaultConfig-ndk&quot; class=&quot;headerlink&quot; title=&quot;android.defaultConfig.ndk&quot;&gt;&lt;/a&gt;&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ProductFlavor.html#com.android.build.gradle.internal.dsl.ProductFlavor:ndk&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;android.defaultConfig.ndk&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;接口原型&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public interface CoreNdkOptions &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String getModuleName();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String getcFlags();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;String&amp;gt; getLdLibs();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Set&amp;lt;String&amp;gt; getAbiFilters();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String getStl();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Integer getJobs();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;注意这里也有cFlags和AbiFilters，这两项和下面的&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ExternalNativeNdkBuildOptions.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;android.defaultConfig.externalNativeBuild&lt;/a&gt;重复，原因暂时我还不知道。&lt;/p&gt;
&lt;p&gt;使用示例：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ndk &amp;#123;//在android节点下面&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    moduleName = &amp;quot;MyLib&amp;quot;    动态库的名称&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    toolchain = &amp;apos;clang&amp;apos;     编译器，据说这个比gcc要快，没有这个写native代码时没有自动补全的功能&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CFlags.addAll([&amp;apos;-Wall&amp;apos;, &amp;apos;-DHELLO_2&amp;apos;])    对应gcc中的编译选项 CFLAGS,方括号内是一个数组，可以有多个值&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CFlags.add(&amp;quot;-DHELLO_3&amp;quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//  CFlags += &amp;quot;-DHELLO&amp;quot;         //这种方式在这里行不通,包括以下的ldFlags, ldLibs 也一样.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ldFlags.addAll([&amp;quot;-L../lib&amp;quot;])       //库文件路径       ldLibs.addAll([&amp;apos;log&amp;apos;])             //库文件名          stl = &amp;quot;stlport_static&amp;quot;      //指示使用动态库还是静态库&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;android-defaultConfig-externalNativeBuild&quot;&gt;&lt;a href=&quot;#android-defaultConfig-externalNativeBuild&quot; class=&quot;headerlink&quot; title=&quot;android.defaultConfig.externalNativeBuild&quot;&gt;&lt;/a&gt;&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ExternalNativeNdkBuildOptions.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;android.defaultConfig.externalNativeBuild&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;构建参数，可以在每个Flavor里特殊定义。&lt;br&gt;见&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ExternalNativeNdkBuildOptions.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;文档&lt;/a&gt;，接口原型为：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public interface CoreExternalNativeNdkBuildOptions &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;String&amp;gt; getArguments();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;String&amp;gt; getcFlags();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;String&amp;gt; getCppFlags();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Set&amp;lt;String&amp;gt; getAbiFilters();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Set&amp;lt;String&amp;gt; getTargets();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在gradle里的使用方法见&lt;a href=&quot;https://developer.android.com/studio/projects/add-native-code.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;android-externalNativeBuild-ndkBuild&quot;&gt;&lt;a href=&quot;#android-externalNativeBuild-ndkBuild&quot; class=&quot;headerlink&quot; title=&quot;android.externalNativeBuild.ndkBuild&quot;&gt;&lt;/a&gt;android.externalNativeBuild.ndkBuild&lt;/h3&gt;&lt;p&gt;这里只能设置路径，只有当Android.mk或CMakeLists.txt不在默认目录上时使用此选项指定目录。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;android &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  defaultConfig &amp;#123;...&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  buildTypes &amp;#123;...&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // Encapsulates your external native build configurations.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  externalNativeBuild &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // Encapsulates your CMake build configurations.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    cmake &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      // Provides a relative path to your CMake build script.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      path &amp;quot;CMakeLists.txt&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // If you want Gradle to package prebuilt native libraries&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // with your APK, modify the default source set configuration&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // to include the directory of your prebuilt .so files as follows.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  sourceSets &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      main &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          jniLibs.srcDirs &amp;apos;imported-lib/src/&amp;apos;, &amp;apos;more-imported-libs/src/&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;buildTypes&quot;&gt;&lt;a href=&quot;#buildTypes&quot; class=&quot;headerlink&quot; title=&quot;buildTypes&quot;&gt;&lt;/a&gt;buildTypes&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;buildTypes &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    release &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        minifyEnabled = false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        proguardFiles.add(file(&amp;apos;proguard-rules.pro&amp;apos;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    debug &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ndk.debuggable = true  //有这个才会支持调试native 代码,这个放到release里一样能用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;引用&quot;&gt;&lt;a href=&quot;#引用&quot; class=&quot;headerlink&quot; title=&quot;引用&quot;&gt;&lt;/a&gt;引用&lt;/h1&gt;&lt;h2 id=&quot;基本概念&quot;&gt;&lt;a href=&quot;#基本概念&quot; class=&quot;headerlink&quot; title=&quot;基本概念&quot;&gt;&lt;/a&gt;基本概念&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/concepts.html&quot;&gt;Android官方文档-概念&lt;/a&gt;，从这里可以发散出JNI、ABI等需要学习的概念，按文档学习即可&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/index.html&quot;&gt;Android Gradle插件节点定义&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;NDK安装配置&quot;&gt;&lt;a href=&quot;#NDK安装配置&quot; class=&quot;headerlink&quot; title=&quot;NDK安装配置&quot;&gt;&lt;/a&gt;NDK安装配置&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/index.html&quot;&gt;Android官方指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/9aff422204eb&quot;&gt;Android Studio里NDK入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/zhaoguangjun33/article/details/51690136&quot;&gt;Android Studio下使用NDK&lt;/a&gt;,这里提供了一些gradle里直接设置toolchain,CFlags等的示例
    
    </summary>
    
      <category term="android" scheme="http://baba.zhaoxiuyuan.com/categories/android/"/>
    
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/tags/java/"/>
    
      <category term="android" scheme="http://baba.zhaoxiuyuan.com/tags/android/"/>
    
      <category term="android studio" scheme="http://baba.zhaoxiuyuan.com/tags/android-studio/"/>
    
  </entry>
  
  <entry>
    <title>Android NDK 知识大全</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/08/119_ndk/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/08/119_ndk/</id>
    <published>2017-08-18T07:12:28.000Z</published>
    <updated>2017-08-18T07:16:54.336Z</updated>
    
    <content type="html">&lt;h1 id=&quot;引用&quot;&gt;&lt;a href=&quot;#引用&quot; class=&quot;headerlink&quot; title=&quot;引用&quot;&gt;&lt;/a&gt;引用&lt;/h1&gt;&lt;h2 id=&quot;基本概念&quot;&gt;&lt;a href=&quot;#基本概念&quot; class=&quot;headerlink&quot; title=&quot;基本概念&quot;&gt;&lt;/a&gt;基本概念&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/concepts.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android官方文档-概念&lt;/a&gt;，从这里可以发散出JNI、ABI等需要学习的概念，按文档学习即可&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Gradle插件节点定义&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;NDK安装配置&quot;&gt;&lt;a href=&quot;#NDK安装配置&quot; class=&quot;headerlink&quot; title=&quot;NDK安装配置&quot;&gt;&lt;/a&gt;NDK安装配置&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android官方指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/9aff422204eb&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Studio里NDK入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/zhaoguangjun33/article/details/51690136&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Studio下使用NDK&lt;/a&gt;,这里提供了一些gradle里直接设置toolchain,CFlags等的示例&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;
&lt;h2 id=&quot;编译选项&quot;&gt;&lt;a href=&quot;#编译选项&quot; class=&quot;headerlink&quot; title=&quot;编译选项&quot;&gt;&lt;/a&gt;编译选项&lt;/h2&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/crash163/article/details/52228412&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android NDK编译选项设置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/wchinaw/article/details/19621285&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;NDK中C++标准库、STL的配置；Include其他头文件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/d9e9ba3312fc&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android Studio中对NDK进行设置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/android_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android官方指南之Androd.mk&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/application_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android官方指南之Androd.mk&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;资料整理&quot;&gt;&lt;a href=&quot;#资料整理&quot; class=&quot;headerlink&quot; title=&quot;资料整理&quot;&gt;&lt;/a&gt;资料整理&lt;/h1&gt;&lt;p&gt;无论是用Android Studio集成NDK，还是手动使用NDK命令行，有两个文件是必须的&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/android_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android.mk&lt;/a&gt;: 在jni文件夹内必须创建这个文件，ndk-build命令也会首先查找此文件才能执行，文件里定义ndk编译的模块的名称、c/c++源代码，需要链接的库及构建选项（传递给编译工具gcc|clang等的参数）。&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/application_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Application.mk&lt;/a&gt;: 这个文件定义需要构建的模块和构建环境及工具，包括以下：&lt;ul&gt;
&lt;li&gt;需要编译的目标平台&lt;a href=&quot;https://developer.android.com/ndk/guides/abis.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;ABI&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;工具链接&lt;/li&gt;
&lt;li&gt;需要包含的标准库(static and dynamic STLport or default system).&lt;/li&gt;
&lt;li&gt;全局的编译选项&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;Android-mk&quot;&gt;&lt;a href=&quot;#Android-mk&quot; class=&quot;headerlink&quot; title=&quot;Android.mk&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/android_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Android.mk&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;示例：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;LOCAL_PATH := $(call my-dir) # 必须要使用这个开头&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;include $(CLEAR_VARS)  # 必须，清除编译环境中所有的LOCAL变量，否则同时编译多个Module时不同的Android.mk里的LOCAL变量会相互影响&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOCAL_MODULE    := mcpelauncher # 必须，定义模块名称&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 必须，源文件文件列表&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOCAL_SRC_FILES := nativepatch.c modscript.c modscript_nextgen.cpp modscript_ScriptLevelListener.cpp utf8proc_slim.c dobby.cpp&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOCAL_C_INCLUDES += E:\C_Shared\sdk\ndk-bundle\platforms\android-14\arch-arm\usr\include\&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOCAL_LDLIBS := -llog   # 需要链接的NDK库&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LOCAL_SHARED_LIBRARIES := tinysubstrate-bin&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;# 必须，包含定义好的一个文件，获取抽有LOCAL变量并决定构建信息&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;include $(BUILD_SHARED_LIBRARY)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$(call import-add-path, prebuilts) # 其它导入模块&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$(call import-module, tinysubstrate-bin)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;变量和宏&quot;&gt;&lt;a href=&quot;#变量和宏&quot; class=&quot;headerlink&quot; title=&quot;变量和宏&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/android_mk.html#var&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;变量和宏&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;命名规则：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;LOCAL_： NDK编译系统使用的，提供给用户设置值&lt;/li&gt;
&lt;li&gt;PRIVATE&lt;em&gt;、NDK&lt;/em&gt;、APP：NDK编译系统内部使用，用户不要定义&lt;/li&gt;
&lt;li&gt;my-dir：一些小写名称，编译系统内部使用的&lt;/li&gt;
&lt;li&gt;MY_: 其它大写名称，是用户自定义（仅仅是推荐，用户可以使用其它前缀或不使用前缀）&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;NDK预定义变量&quot;&gt;&lt;a href=&quot;#NDK预定义变量&quot; class=&quot;headerlink&quot; title=&quot;NDK预定义变量&quot;&gt;&lt;/a&gt;NDK预定义变量&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;CLEAR_VARS&lt;/strong&gt; &lt;code&gt;include $(CLEAR_VARS)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;BUILD_SHARED_LIBRARY | BUILD_STATIC_LIBRARY&lt;/strong&gt; &lt;code&gt;include $(BUILD_SHARED_LIBRARY)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;PREBUILT_SHARED_LIBRARY | PREBUILT_STATIC_LIBRARY&lt;/strong&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TARGET_ARCH&lt;/strong&gt; 目标cpu架构 取值arm、x86等&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TARGET_PLATFORM&lt;/strong&gt; 目标android版本 &lt;code&gt;TARGET_PLATFORM := android-22&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TARGET_ARCH_ABI&lt;/strong&gt; 目标cpu及架构的全名 如：&lt;code&gt;TARGET_ARCH_ABI := arm64-v8a x86&lt;/code&gt;，详表见&lt;a href=&quot;https://developer.android.com/ndk/guides/android_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;官方文档&lt;/a&gt;中TARGET_ARCH_ABI一节。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;TARGET_ABI&lt;/strong&gt; Android Api级别和ABI的组合&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;模块定义变量&quot;&gt;&lt;a href=&quot;#模块定义变量&quot; class=&quot;headerlink&quot; title=&quot;模块定义变量&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/android_mk.html#mdv&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;模块定义变量&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;这些变量是每个模块单独设置的，每个模块都需要做以下事情：&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;初使化模块变量或者用CLEAR_VARS清除&lt;/li&gt;
&lt;li&gt;给一些变量赋值来描述模块的功能&lt;/li&gt;
&lt;li&gt;使用NDK预定义变量中的BUILD_XXX来定义模块的格式（动态库、静态库等）&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;变量列表（粗体为必须）：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;LOCAL_PATH&lt;/strong&gt; 设置当前文件的路径，必须在Androd.mk的开头使用&lt;code&gt;LOCAL_PATH := $(call my-dir)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LOCAL_MODULE&lt;/strong&gt; 当前模块名称，不能用空格。除了&lt;code&gt;CLEAR_VARS&lt;/code&gt;之外他要放在前面，不需要添加lib前缀和.so.a后缀。&lt;/li&gt;
&lt;li&gt;LOCAL_MODULE_FILENAME 模块文件名，可以指定一个新的模块文件名&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;LOCAL_SRC_FILES&lt;/strong&gt; 源文件文件列表&lt;/li&gt;
&lt;li&gt;LOCAL_CPP_EXTENSION 定义支持的c++源文件的后缀，一般来说可以用&lt;code&gt;LOCAL_CPP_EXTENSION := .cxx .cpp .cc&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;LOCAL_CPP_FEATURES c++语言特性，如rtti、exceptions等&lt;/li&gt;
&lt;li&gt;LOCAL_C_INCLUDES 头文件默认是相对于NDK的根目录，如果相对于当前目录要用&lt;code&gt;LOCAL_C_INCLUDES := $(LOCAL_PATH)//foo&lt;/code&gt;,需要设置在LOCAL_CFLAGS和LOCAL_CPPFLAGS &lt;strong&gt;之前&lt;/strong&gt;。ps：在windows上我想直接引用ndk目录，但使用了LOCAL_PATH后似乎就默认是当前目录了， 所以我最后使用了环境变量中的ndk目录。例：&lt;code&gt;LOCAL_C_INCLUDES += $(ANDROID_NDK_HOME)\platforms\$(TARGET_PLATFORM)\arch-$(TARGET_ARCH)\usr\include&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;LOCAL_CFLAGS 给c和c++的编译选项，从 android-ndk-1.5_r1开始，此选项仅适用于c语言&lt;/li&gt;
&lt;li&gt;LOCAL_CPPFLAGS 给c++的编译选项&lt;/li&gt;
&lt;li&gt;LOCAL_STATIC_LIBRARIES 当前模块依赖的静态库，如果当前模块也是静态库，这个表明引用当前模块的也自动依赖这些静态库。如果当前模块是可执行程序或动态库，则链接这些静态库。&lt;/li&gt;
&lt;li&gt;LOCAL_SHARED_LIBRARIES 运行时依赖的动态库，仅用在链接时&lt;/li&gt;
&lt;li&gt;LOCAL_LDLIBS 声明链接时引用的动态库,-l作为前缀，例&lt;code&gt;LOCAL_LDLIBS := -lz&lt;/code&gt;声明需要链接&lt;code&gt;/system/lib/libz.so&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;LOCAL_LDFLAGS 链接参数，如果当前模块是是静态库，此参数无效&lt;/li&gt;
&lt;li&gt;LOCAL_ALLOW_UNDEFINED_SYMBOLS 当设置成true时，链接时不检查未定义的引用。如果当前模块是是静态库，此参数无效&lt;/li&gt;
&lt;li&gt;LOCAL_WHOLE_STATIC_LIBRARIES、LOCAL_ARM_MODE、LOCAL_ARM_NEON、LOCAL_DISABLE_NO_EXECUTE、LOCAL_DISABLE_RELRO、LOCAL_DISABLE_FORMAT_STRING_CHECKS、LOCAL_SHORT_COMMANDS、LOCAL_THIN_ARCHIVE、LOCAL_FILTER_ASM等 略，详见文档&lt;/li&gt;
&lt;li&gt;LOCAL_EXPORT_XXX系列指令&lt;/li&gt;
&lt;li&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;预定义函数&quot;&gt;&lt;a href=&quot;#预定义函数&quot; class=&quot;headerlink&quot; title=&quot;预定义函数&quot;&gt;&lt;/a&gt;预定义函数&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;my-dir&lt;/strong&gt; 获取最后一个makefile的目录&lt;/li&gt;
&lt;li&gt;all-subdir-makefiles 返回所有子目录中的Android.mk&lt;/li&gt;
&lt;li&gt;this-makefile 当前makefile的路径&lt;/li&gt;
&lt;li&gt;parent-makefile 上级makefile的路径&lt;/li&gt;
&lt;li&gt;grand-parent-makefile 上上级makefile的路径&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;import-module&lt;/strong&gt; 使用方式&lt;code&gt;$(call import-module,&amp;lt;name&amp;gt;)&lt;/code&gt;,在NDK_MODULE_PATH环境变量中查找指定名称的模块，然后inlucde它的Android.mk文件&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;Application-mk&quot;&gt;&lt;a href=&quot;#Application-mk&quot; class=&quot;headerlink&quot; title=&quot;Application.mk&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/application_mk.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Application.mk&lt;/a&gt;&lt;/h2&gt;&lt;p&gt;示例：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;APP_ABI := x86 #只生成x86架构的CPU用的lib，要生成所有平台的可以改为all    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#APP_STL := stlport_static  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;NDK_TOOLCHAIN_VERSION=4.7 #使用GCC4.7  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;APP_STL := gnustl_static #GNU STL  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;APP_CPPFLAGS := -fexceptions -frtti #允许异常功能，及运行时类型识别  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;APP_CPPFLAGS +=-std=c++11 #允许使用c++11的函数等功能  &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;APP_CPPFLAGS +=-fpermissive  #此项有效时表示宽松的编译形式，比如没有用到的代码中有错误也可以通过编译；使用GNU STL时不用此项std::string 居然编译不通过！！&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;变量&quot;&gt;&lt;a href=&quot;#变量&quot; class=&quot;headerlink&quot; title=&quot;变量&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/application_mk.html#var&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;变量&lt;/a&gt;&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;APP_PROJECT_PATH app的根目录，如果当前Application.mk放在&lt;code&gt;$PROJECT/jni/&lt;/code&gt;下，则不需要设置此变量&lt;/li&gt;
&lt;li&gt;APP_MODULES 如果定义了此变量，则只编译指定的模块。模块名使用空格间隔&lt;/li&gt;
&lt;li&gt;APP_OPTIM release 或 debug ,默认值是release，如果在Android项目中定义了android:debuggable,，则默认是debug&lt;/li&gt;
&lt;li&gt;APP_CFLAGS 所有模块通用的c编译参数&lt;/li&gt;
&lt;li&gt;APP_CPPFLAGS 所有模块通用的c++编译参数&lt;/li&gt;
&lt;li&gt;APP_LDFLAGS 所有模块通用的链接参数&lt;/li&gt;
&lt;li&gt;APP_BUILD_SCRIPT ndk墨认在jin/下找文件Android.mk，可以使用这个变量指定编译脚本路径。&lt;/li&gt;
&lt;li&gt;APP_ABI 默认ndk生成的是armeabi，可以使用此变量来指定，例：&lt;code&gt;APP_ABI := armeabi armeabi-v7a x86 mips&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;APP_PLATFORM 指定最小支持android版本，最好不要使用此选项，而是使用模块的build.gradle中的defaultConfig 或 productFlavors 中的minSdkVersion来指定。&lt;/li&gt;
&lt;li&gt;APP_STL 默认使用系统的std库，可以使用这个指定，可选的见&lt;a href=&quot;https://developer.android.com/ndk/guides/cpp-support.html#runtimes&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;官方文档&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;NDK_TOOLCHAIN_VERSION 指定编译工具的版本，如果是&lt;code&gt;clang&lt;/code&gt;就是引用Clang编译器，如果是&lt;code&gt;4.9&lt;/code&gt;这种，就是指定GCC的版本&lt;/li&gt;
&lt;li&gt;APP_SHORT_COMMANDS、APP_PIE、APP_THIN_ARCHIVE 略过，详见文档&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;gradle配置&quot;&gt;&lt;a href=&quot;#gradle配置&quot; class=&quot;headerlink&quot; title=&quot;gradle配置&quot;&gt;&lt;/a&gt;gradle配置&lt;/h2&gt;&lt;p&gt;nkd的配置也分散在grale中&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.BaseExtension.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;android节点&lt;/a&gt;下面的各个节点中，主要在ndk，&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ExternalNativeNdkBuildOptions.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;defaultConfig.externalNativeBuild.ndkBuild&lt;/a&gt;、&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ExternalNativeBuild.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;externalNativeBuild.ndkBuild&lt;/a&gt;中，同时在sourceSets中对文件包含进行一些修改，flavor和build-types在不同的编译选项下打不同的包。&lt;/p&gt;
&lt;h3 id=&quot;android-defaultConfig-ndk&quot;&gt;&lt;a href=&quot;#android-defaultConfig-ndk&quot; class=&quot;headerlink&quot; title=&quot;android.defaultConfig.ndk&quot;&gt;&lt;/a&gt;&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ProductFlavor.html#com.android.build.gradle.internal.dsl.ProductFlavor:ndk&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;android.defaultConfig.ndk&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;接口原型&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public interface CoreNdkOptions &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String getModuleName();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String getcFlags();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;String&amp;gt; getLdLibs();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Set&amp;lt;String&amp;gt; getAbiFilters();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String getStl();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Integer getJobs();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;注意这里也有cFlags和AbiFilters，这两项和下面的&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ExternalNativeNdkBuildOptions.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;android.defaultConfig.externalNativeBuild&lt;/a&gt;重复，原因暂时我还不知道。&lt;/p&gt;
&lt;p&gt;使用示例：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;ndk &amp;#123;//在android节点下面&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    moduleName = &amp;quot;MyLib&amp;quot;    动态库的名称&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    toolchain = &amp;apos;clang&amp;apos;     编译器，据说这个比gcc要快，没有这个写native代码时没有自动补全的功能&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CFlags.addAll([&amp;apos;-Wall&amp;apos;, &amp;apos;-DHELLO_2&amp;apos;])    对应gcc中的编译选项 CFLAGS,方括号内是一个数组，可以有多个值&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    CFlags.add(&amp;quot;-DHELLO_3&amp;quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//  CFlags += &amp;quot;-DHELLO&amp;quot;         //这种方式在这里行不通,包括以下的ldFlags, ldLibs 也一样.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    ldFlags.addAll([&amp;quot;-L../lib&amp;quot;])       //库文件路径       ldLibs.addAll([&amp;apos;log&amp;apos;])             //库文件名          stl = &amp;quot;stlport_static&amp;quot;      //指示使用动态库还是静态库&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;android-defaultConfig-externalNativeBuild&quot;&gt;&lt;a href=&quot;#android-defaultConfig-externalNativeBuild&quot; class=&quot;headerlink&quot; title=&quot;android.defaultConfig.externalNativeBuild&quot;&gt;&lt;/a&gt;&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ExternalNativeNdkBuildOptions.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;android.defaultConfig.externalNativeBuild&lt;/a&gt;&lt;/h3&gt;&lt;p&gt;构建参数，可以在每个Flavor里特殊定义。&lt;br&gt;见&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/com.android.build.gradle.internal.dsl.ExternalNativeNdkBuildOptions.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;文档&lt;/a&gt;，接口原型为：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public interface CoreExternalNativeNdkBuildOptions &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;String&amp;gt; getArguments();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;String&amp;gt; getcFlags();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    List&amp;lt;String&amp;gt; getCppFlags();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Set&amp;lt;String&amp;gt; getAbiFilters();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    Set&amp;lt;String&amp;gt; getTargets();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在gradle里的使用方法见&lt;a href=&quot;https://developer.android.com/studio/projects/add-native-code.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;这里&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;android-externalNativeBuild-ndkBuild&quot;&gt;&lt;a href=&quot;#android-externalNativeBuild-ndkBuild&quot; class=&quot;headerlink&quot; title=&quot;android.externalNativeBuild.ndkBuild&quot;&gt;&lt;/a&gt;android.externalNativeBuild.ndkBuild&lt;/h3&gt;&lt;p&gt;这里只能设置路径，只有当Android.mk或CMakeLists.txt不在默认目录上时使用此选项指定目录。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;android &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  defaultConfig &amp;#123;...&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  buildTypes &amp;#123;...&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // Encapsulates your external native build configurations.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  externalNativeBuild &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // Encapsulates your CMake build configurations.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    cmake &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      // Provides a relative path to your CMake build script.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      path &amp;quot;CMakeLists.txt&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // If you want Gradle to package prebuilt native libraries&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // with your APK, modify the default source set configuration&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // to include the directory of your prebuilt .so files as follows.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  sourceSets &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      main &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;          jniLibs.srcDirs &amp;apos;imported-lib/src/&amp;apos;, &amp;apos;more-imported-libs/src/&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;buildTypes&quot;&gt;&lt;a href=&quot;#buildTypes&quot; class=&quot;headerlink&quot; title=&quot;buildTypes&quot;&gt;&lt;/a&gt;buildTypes&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;buildTypes &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    release &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        minifyEnabled = false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        proguardFiles.add(file(&amp;apos;proguard-rules.pro&amp;apos;))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    debug &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ndk.debuggable = true  //有这个才会支持调试native 代码,这个放到release里一样能用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;引用&quot;&gt;&lt;a href=&quot;#引用&quot; class=&quot;headerlink&quot; title=&quot;引用&quot;&gt;&lt;/a&gt;引用&lt;/h1&gt;&lt;h2 id=&quot;基本概念&quot;&gt;&lt;a href=&quot;#基本概念&quot; class=&quot;headerlink&quot; title=&quot;基本概念&quot;&gt;&lt;/a&gt;基本概念&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/concepts.html&quot;&gt;Android官方文档-概念&lt;/a&gt;，从这里可以发散出JNI、ABI等需要学习的概念，按文档学习即可&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://google.github.io/android-gradle-dsl/current/index.html&quot;&gt;Android Gradle插件节点定义&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;NDK安装配置&quot;&gt;&lt;a href=&quot;#NDK安装配置&quot; class=&quot;headerlink&quot; title=&quot;NDK安装配置&quot;&gt;&lt;/a&gt;NDK安装配置&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://developer.android.com/ndk/guides/index.html&quot;&gt;Android官方指南&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.jianshu.com/p/9aff422204eb&quot;&gt;Android Studio里NDK入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/zhaoguangjun33/article/details/51690136&quot;&gt;Android Studio下使用NDK&lt;/a&gt;,这里提供了一些gradle里直接设置toolchain,CFlags等的示例
    
    </summary>
    
      <category term="android" scheme="http://baba.zhaoxiuyuan.com/categories/android/"/>
    
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/tags/java/"/>
    
      <category term="android" scheme="http://baba.zhaoxiuyuan.com/tags/android/"/>
    
      <category term="android studio" scheme="http://baba.zhaoxiuyuan.com/tags/android-studio/"/>
    
  </entry>
  
  <entry>
    <title>java的asm若干实践</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/08/117_java_asm/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/08/117_java_asm/</id>
    <published>2017-08-03T08:50:28.000Z</published>
    <updated>2017-08-04T01:15:37.681Z</updated>
    
    <content type="html">&lt;h1 id=&quot;一、前置知识、工具、代码库等&quot;&gt;&lt;a href=&quot;#一、前置知识、工具、代码库等&quot; class=&quot;headerlink&quot; title=&quot;一、前置知识、工具、代码库等&quot;&gt;&lt;/a&gt;一、前置知识、工具、代码库等&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;jdk里的javap，用来反汇编class文件查看生成的字节码&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://asm.ow2.org/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;org.objectweb.asm&lt;/a&gt; 用来解析、修改、保存字节码的代码库&lt;/li&gt;
&lt;li&gt;fernflower.jar 用来批量将class文件反编译成java代码（当然idea也可以手动单个反编译)&lt;/li&gt;
&lt;li&gt;java的&lt;a href=&quot;https://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Instrumentation&lt;/a&gt;，可以编写代码使用javaagent代理执行其它java文件，在代码里使用上面的asm库动态修改代码。也可以直接将所有字节保存，并加载其它class文件。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;二、Instrumentation&quot;&gt;&lt;a href=&quot;#二、Instrumentation&quot; class=&quot;headerlink&quot; title=&quot;二、Instrumentation&quot;&gt;&lt;/a&gt;二、Instrumentation&lt;/h1&gt;&lt;p&gt;在代理jar包中MANIFEST.MF使用Premain-Class指定代理类，代理类需要有premain方法，此方法会在被代理的jar包的main执行前执行：&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public static void premain(String var0, Instrumentation inst) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   inst.addTransformer(new MyTransformer());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;JVM在加载每一个类时，都会调用MyTransformer的transform方法对字节码进行处理:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public final byte[] transform(ClassLoader l, String className, Class&amp;lt;?&amp;gt; c,ProtectionDomain pd, byte[] b) throws IllegalClassFormatException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   // 在这里可以根据className筛选到自己想要更改的类&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   if (className.equal(&amp;quot;example&amp;quot;))&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     b = getAnotherCodeArray(b);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     b = modifyCodeArray(b);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   return b;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;在transform函数也可保存修改前或修改后的字节为class文件，只需要直接将b保存成class文件即可。&lt;/li&gt;
&lt;li&gt;如果transform里抛出异常，程序也能正常执行，只不过类没有发生任何变化(因为没有返回修改过的字节码)。&lt;/li&gt;
&lt;li&gt;如果修改过的字节码中，有错误，比如在生成方法的局部变量时，生成了如下格式&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;LocalVariableTable:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Start  Length  Slot  Name   Signature&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    45      65     0  this   Lnet/minecraft/client/network/NetHandlerLoginClient;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    45      65     1 packetIn   Lnet/minecraft/network/login/server/SPacketLoginSuccess;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    0       0     2 address   desc&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其中address对应的类型为desc，显然是非法的，则启动程序时会报异常：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;java.lang.NoClassDefFoundError: net/minecraft/client/network/NetHandlerLoginClient&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Caused by: java.lang.ClassFormatError: Field &amp;quot;address&amp;quot; in class net/minecraft/client/network/NetHandlerLoginClient has illegal signature &amp;quot;desc&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;三、asm实践&quot;&gt;&lt;a href=&quot;#三、asm实践&quot; class=&quot;headerlink&quot; title=&quot;三、asm实践&quot;&gt;&lt;/a&gt;三、asm实践&lt;/h1&gt;&lt;p&gt;使用asm修改字节码的示例有很多，这里就不再详细列举，这里仅说几个我填过的坑。在破解forge版本minecraft游戏的过程中，有些asm代码在老版本执行正常，但是在v1.12版本就导致游戏崩溃。&lt;/p&gt;
&lt;p&gt;在transform里将修改过的代码保存成class文件并且通过idea反汇编成java文件，对比1.11和1.12两个版本生成的java代码是一样的，在各种调整jvm参数、java版本、asm库版本之后，最终找到原因和解决办法。&lt;/p&gt;
&lt;h3 id=&quot;错误1：Caused-by-java-lang-VerifyError-Expecting-a-stackmap-frame-at-branch-target-xxx&quot;&gt;&lt;a href=&quot;#错误1：Caused-by-java-lang-VerifyError-Expecting-a-stackmap-frame-at-branch-target-xxx&quot; class=&quot;headerlink&quot; title=&quot;错误1：Caused by: java.lang.VerifyError: Expecting a stackmap frame at branch target xxx&quot;&gt;&lt;/a&gt;错误1：Caused by: java.lang.VerifyError: Expecting a stackmap frame at branch target xxx&lt;/h3&gt;&lt;p&gt;此bug是因为原有代码在插入了一些if(xxx)等分支流程，假设代码是：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;MethodNode method = xxx;// 从原字节码里使用ClassReader得到方法对象。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// 插入自己的新的指令&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;InsnList rawMethodInstructions = method.instructions;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;InsnList newCall = new InsnList();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// 在某处逻辑添加了跳转指令&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;LabelNode labelNode = new LabelNode();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;newCall.add(new JumpInsnNode(Opcodes.IFEQ, labelNode));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;newCall.add(labelNode);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; rawMethodInstructions.insertBefore(rawMethodInstructions.getFirst(), newCall);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; method.maxStack += 4;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;以上代码在很多mc版本上都正常运行，只有v1.12版本才会报标题中的错误。是因为v1.12的代码在执行时对生成字节码的StackMapTable区域做了检测。在未修改之前的原方法中可能StackMapTable是这样的：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;StackMapTable: number_of_entries = 6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 10 /* same */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 33 /* same */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 64 /* same_locals_1_stack_item */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    stack = [ int ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 252 /* append */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    offset_delta = 20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    locals = [ int ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 252 /* append */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    offset_delta = 34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    locals = [ class net/minecraft/entity/Entity ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 250 /* chop */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    offset_delta = 42&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;以上方法修改后，生成的字节码是这样的：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;StackMapTable: number_of_entries = 6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 10 /* same */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 33 /* same */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 64 /* same_locals_1_stack_item */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    stack = [ int ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 252 /* append */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    offset_delta = 20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    locals = [ int ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 252 /* append */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    offset_delta = 34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    locals = [ class net/minecraft/entity/Entity ]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 250 /* chop */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    offset_delta = 42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  frame_type = 6 /* same */&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;其实这个 frame_type 的顺序应该和代码块的顺序一致（至于StackMapTable对应代码结构的关系可以见（&lt;a href=&quot;http://hllvm.group.iteye.com/group/topic/26545中R大的解释及其它资料）。&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://hllvm.group.iteye.com/group/topic/26545中R大的解释及其它资料）。&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;知道这个特性后，尝试了给java添加了&lt;a href=&quot;http://blog.csdn.net/u012881904/article/details/51337347&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;某博客&lt;/a&gt;提到的 &lt;em&gt;-noverify&lt;/em&gt; 和 &lt;em&gt;-XX:-UseSplitVerifier&lt;/em&gt; 这两个jvm参数来禁用字节码验证，然而不知道为什么并没有卵用。&lt;/p&gt;
&lt;p&gt;最后使用asm在代码合适的位置补上了一个frame解决问题。&lt;/p&gt;
&lt;h3 id=&quot;错误2：java-lang-VerifyError-Bad-local-variable-type&quot;&gt;&lt;a href=&quot;#错误2：java-lang-VerifyError-Bad-local-variable-type&quot; class=&quot;headerlink&quot; title=&quot;错误2：java.lang.VerifyError: Bad local variable type&quot;&gt;&lt;/a&gt;错误2：java.lang.VerifyError: Bad local variable type&lt;/h3&gt;&lt;p&gt;hook代码增加了局部变量，需要手动设置LocalVariableTable，通过 &lt;code&gt;methodnode.visitLocalVariable&lt;/code&gt;来增加变量，注意第三个参数signature如果不是generic types，则不需要设置。例如：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/**&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;* 必须要调该方法，手动设置LocalVariableTable，否则会报 Caused by: java.lang.VerifyError: Bad local variable type&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;*/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;methodnode.visitLocalVariable(&amp;quot;addressObj&amp;quot;, &amp;quot;Ljava/net/SocketAddress;&amp;quot;, null, newLabelBegin.getLabel(), newLabel2.getLabel(), 3);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;methodnode.visitLocalVariable(&amp;quot;addressStr&amp;quot;, &amp;quot;Ljava/lang/String;&amp;quot;, null, newLabelBegin.getLabel(), newLabel2.getLabel(), 4);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;一、前置知识、工具、代码库等&quot;&gt;&lt;a href=&quot;#一、前置知识、工具、代码库等&quot; class=&quot;headerlink&quot; title=&quot;一、前置知识、工具、代码库等&quot;&gt;&lt;/a&gt;一、前置知识、工具、代码库等&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;jdk里的javap，用来反汇编class文件查看生成的字节码&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://asm.ow2.org/&quot;&gt;org.objectweb.asm&lt;/a&gt; 用来解析、修改、保存字节码的代码库&lt;/li&gt;
&lt;li&gt;fernflower.jar 用来批量将class文件反编译成java代码（当然idea也可以手动单个反编译)&lt;/li&gt;
&lt;li&gt;java的&lt;a href=&quot;https://www.ibm.com/developerworks/cn/java/j-lo-jse61/index.html&quot;&gt;Instrumentation&lt;/a&gt;，可以编写代码使用javaagent代理执行其它java文件，在代码里使用上面的asm库动态修改代码。也可以直接将所有字节保存，并加载其它class文件。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;二、Instrumentation&quot;&gt;&lt;a href=&quot;#二、Instrumentation&quot; class=&quot;headerlink&quot; title=&quot;二、Instrumentation&quot;&gt;&lt;/a&gt;二、Instrumentation&lt;/h1&gt;&lt;p&gt;在代理jar包中MANIFEST.MF使用Premain-Class指定代理类，代理类需要有premain方法，此方法会在被代理的jar包的main执行前执行：&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/categories/java/"/>
    
      <category term="minecraft" scheme="http://baba.zhaoxiuyuan.com/categories/java/minecraft/"/>
    
    
      <category term="minecraft" scheme="http://baba.zhaoxiuyuan.com/tags/minecraft/"/>
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/tags/java/"/>
    
      <category term="asm" scheme="http://baba.zhaoxiuyuan.com/tags/asm/"/>
    
  </entry>
  
  <entry>
    <title>Spigot编译流程</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/08/118_spigot/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/08/118_spigot/</id>
    <published>2017-08-03T08:50:28.000Z</published>
    <updated>2017-08-04T07:05:55.446Z</updated>
    
    <content type="html">&lt;h1 id=&quot;相关文档&quot;&gt;&lt;a href=&quot;#相关文档&quot; class=&quot;headerlink&quot; title=&quot;相关文档&quot;&gt;&lt;/a&gt;相关文档&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.spigotmc.org/wiki/buildtools/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;buildtools帮助文档&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://hub.spigotmc.org/jenkins/job/BuildTools/lastSuccessfulBuild/artifact/target/BuildTools.jar&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;BuildTool.jar下载地址&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;使用说明&quot;&gt;&lt;a href=&quot;#使用说明&quot; class=&quot;headerlink&quot; title=&quot;使用说明&quot;&gt;&lt;/a&gt;使用说明&lt;/h1&gt;&lt;p&gt;使用gitbash打开当前目录，输入&lt;code&gt;java -jar BuildTools.jar --rev 1.8&lt;/code&gt;,这里的1.8可以替换成其它版本，如1.10,1.10.2等。&lt;/p&gt;
&lt;h1 id=&quot;流程一，下载代码&quot;&gt;&lt;a href=&quot;#流程一，下载代码&quot; class=&quot;headerlink&quot; title=&quot;流程一，下载代码&quot;&gt;&lt;/a&gt;流程一，下载代码&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;克隆git代码&lt;a href=&quot;https://hub.spigotmc.org/stash/scm/spigot/bukkit.git&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;bukkit&lt;/a&gt; 到 &lt;code&gt;bukkit&lt;/code&gt; 目录&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;克隆git代码&lt;a href=&quot;https://hub.spigotmc.org/stash/scm/spigot/craftbukkit.git&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;craftbukkit&lt;/a&gt; 到 &lt;code&gt;craftbukkit&lt;/code&gt; 目录&lt;/li&gt;
&lt;li&gt;克隆git代码&lt;a href=&quot;https://hub.spigotmc.org/stash/scm/spigot/spigot.git&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;spigot&lt;/a&gt; 到 &lt;code&gt;Spigot&lt;/code&gt; 目录&lt;/li&gt;
&lt;li&gt;克隆git代码&lt;a href=&quot;https://hub.spigotmc.org/stash/scm/spigot/builddata.git&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;buildata&lt;/a&gt;到 &lt;code&gt;BuildData&lt;/code&gt; 目录&lt;/li&gt;
&lt;li&gt;下载&lt;a href=&quot;https://static.spigotmc.org/maven/apache-maven-3.2.5-bin.zip&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;maven工具&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;从服务器上查询命令行中指定的rev对应的各代码库的分支，如&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Attempting to build version: &amp;apos;1.8&amp;apos; use --rev &amp;lt;version&amp;gt; to override&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Found version&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;quot;name&amp;quot;: &amp;quot;1.8&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;quot;description&amp;quot;: &amp;quot;Backport of fixes from 1.8.3&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;quot;information&amp;quot;: &amp;quot;Last build of Spigot 1.8.0. To update please see http://www.spigotmc.org/&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;quot;warning&amp;quot;: &amp;quot;***** Please ensure your BuildTools is at least #35 *****&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;quot;refs&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;quot;BuildData&amp;quot;: &amp;quot;0630ea462a82fdbd93018de7d5ec5e9d3b3c732b&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;quot;Bukkit&amp;quot;: &amp;quot;1d2509b99fb10b3bd6f597e63805f85b49d5a055&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;quot;CraftBukkit&amp;quot;: &amp;quot;7019900e276b7c9f6e940debf8529094c7f4da0c&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		&amp;quot;Spigot&amp;quot;: &amp;quot;550ebace4b43adc73854d7d5976e1343eba6fb98&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;将4个文件夹中的代码更新到指定标签&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;目录说明&quot;&gt;&lt;a href=&quot;#目录说明&quot; class=&quot;headerlink&quot; title=&quot;目录说明&quot;&gt;&lt;/a&gt;目录说明&lt;/h2&gt;&lt;h3 id=&quot;BuildData&quot;&gt;&lt;a href=&quot;#BuildData&quot; class=&quot;headerlink&quot; title=&quot;BuildData&quot;&gt;&lt;/a&gt;BuildData&lt;/h3&gt;&lt;p&gt;反编译工具及反编译minecraft使用的代码映射。&lt;/p&gt;
&lt;h3 id=&quot;CraftBukkit&quot;&gt;&lt;a href=&quot;#CraftBukkit&quot; class=&quot;headerlink&quot; title=&quot;CraftBukkit&quot;&gt;&lt;/a&gt;CraftBukkit&lt;/h3&gt;&lt;p&gt;对minecraft server的魔改，改善性能，并支持插件等。&lt;/p&gt;
&lt;h3 id=&quot;Bukkit&quot;&gt;&lt;a href=&quot;#Bukkit&quot; class=&quot;headerlink&quot; title=&quot;Bukkit&quot;&gt;&lt;/a&gt;Bukkit&lt;/h3&gt;&lt;p&gt;Bukkit是服务器插件编程接口，封装不同版本minecraft server的细节，统一接口，便于开发插件。&lt;/p&gt;
&lt;h3 id=&quot;Spigot目录&quot;&gt;&lt;a href=&quot;#Spigot目录&quot; class=&quot;headerlink&quot; title=&quot;Spigot目录&quot;&gt;&lt;/a&gt;Spigot目录&lt;/h3&gt;&lt;p&gt;spigot服务器是一个改良服务器，在文件夹里是两个补丁目录，CraftBukkit-Patches存放对craftBukkit代码的补丁，Bukkit-Patches存放对Bukkit代码的补丁。&lt;/p&gt;
&lt;h1 id=&quot;流程二，下载minecraft-server并反编译&quot;&gt;&lt;a href=&quot;#流程二，下载minecraft-server并反编译&quot; class=&quot;headerlink&quot; title=&quot;流程二，下载minecraft server并反编译&quot;&gt;&lt;/a&gt;流程二，下载minecraft server并反编译&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;下载纯净版本minecraft服务器jar包（此处应有梯子）。&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Attempting to build Minecraft with details: VersionInfo(minecraftVersion=1.8, accessTransforms=bukkit-1.8.at, classMappings=bukkit-1.8-cl.csrg, memberMappings=bukkit-1.8-members.csrg, packageMappings=package.srg, minecraftHash=null, decompileCommand=null, serverUrl=null)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Starting download of https://s3.amazonaws.com/Minecraft.Download/versions/1.8/minecraft_server.1.8.jar&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;如果下载不下来，也可以迅雷下载后直接放在work目录中，如果已经存在，则会提示：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Found good Minecraft hash (5b19d1a562a8a7c5f9a787ad96c8148b)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Found good Minecraft hash (5b19d1a562a8a7c5f9a787ad96c8148b)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;反编译代码&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Final mapped jar: work\mapped.8eb82bde.jar does not exist, creating!&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Loading mappings&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Loading mappings&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;1 packages, 0 classes, 0 fields, 0 methods&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;INFO: merging AccessMap net/minecraft/server/CraftingManager/recipes from AccessChange(clear=16, set=0, vis=1) with AccessChange(clear=0, set=0, vis=1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;INFO: merging AccessMap net/minecraft/server/PropertyManager/properties from AccessChange(clear=0, set=0, vis=1) with AccessChange(clear=0, set=0, vis=1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;INFO: merging AccessMap net/minecraft/server/TileEntityBrewingStand/items from AccessChange(clear=0, set=0, vis=1) with AccessChange(clear=0, set=0, vis=1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;INFO: merging AccessMap net/minecraft/server/WorldServer/tracker from AccessChange(clear=16, set=0, vis=1) with AccessChange(clear=0, set=0, vis=1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;INFO: merging AccessMap net/minecraft/server/WorldManager/world from AccessChange(clear=0, set=0, vis=1) with AccessChange(clear=0, set=0, vis=1)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Remapping final jar&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;将minecraft-server的class文件释放到work目录下的&lt;code&gt;decompile-xxxxxxxx&lt;/code&gt;目录的&lt;code&gt;classes&lt;/code&gt;子目录。&lt;/li&gt;
&lt;li&gt;根据map文件，将释放的class文件，反编译到work目录下的&lt;code&gt;decompile-xxxxxxxx&lt;/code&gt;中。&lt;/li&gt;
&lt;li&gt;将生成的java文件，编译并生成minecraft-server-1.8-SNAPSHOT.jar到mvn的代码仓库目录&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;[INFO] Scanning for projects...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[INFO]                                                                         &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[INFO] ------------------------------------------------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[INFO] Building Maven Stub Project (No POM) 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[INFO] ------------------------------------------------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[INFO] &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[INFO] --- maven-install-plugin:2.4:install-file (default-cli) @ standalone-pom ---&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[INFO] Installing D:\mc\spigotmc_build\work\mapped.8eb82bde.jar to D:\repo\repository\org\spigotmc\minecraft-server\1.8-SNAPSHOT\minecraft-server-1.8-SNAPSHOT.jar&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[INFO] Installing C:\Users\terry\AppData\Local\Temp\mvninstall1056450265315348368.pom to D:\repo\repository\org\spigotmc\minecraft-server\1.8-SNAPSHOT\minecraft-server-1.8-SNAPSHOT.pom&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[INFO] ------------------------------------------------------------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;[INFO] BUILD SUCCESS&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;extract ....*.class&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Decomiling ***.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Applying CraftBukkit Patches&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;应用代码补丁&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Applying CraftBukkit Patches&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Patching with BiomeDecorator.patch&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Patching with BiomeTheEndDecorator.patch&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;并各种文件夹合并,将Bukkit和CraftBukkit的代码都checkout一份到Spigot目录。&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;流程三，编译代码&quot;&gt;&lt;a href=&quot;#流程三，编译代码&quot; class=&quot;headerlink&quot; title=&quot;流程三，编译代码&quot;&gt;&lt;/a&gt;流程三，编译代码&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;编译Bukkit和CraftBukkit,并且都输出到Maven本地仓库。&lt;/li&gt;
&lt;li&gt;将Bukkit和CraftBukkit的代码check out到Spigot中的Spigot-API和Spigot-Server，然后分别打上补丁(Bukkit-Patches和CraftBukkit-Patches)。&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Rebuilding Forked projects.... &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;From file:///D:\mc\spigotmc_build\Bukkit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * [new branch]      spigot     -&amp;gt; origin/spigot&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HEAD is now at 1d2509b Revert finite checks in locations. Fixes SPIGOT-628 and others&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Cloning into &amp;apos;Spigot-API&amp;apos;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;done.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Resetting Spigot-API to Bukkit...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HEAD is now at 36052f0 CraftBukkit $ Fri Aug 04 14:37:11 CST 2017&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Cloning into &amp;apos;Spigot-Server&amp;apos;...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;done.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Resetting Spigot-Server to CraftBukkit...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;ul&gt;
&lt;li&gt;编译输出 craftbukkit-1.8.jar 和 spigot-1.8.jar 等&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Success! Everything compiled successfully. Copying final .jar files now.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Copying craftbukkit-1.8-R0.1-SNAPSHOT-remapped.jar to D:\mc\spigotmc_build\.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - Saved as craftbukkit-1.8.jar&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Copying craftbukkit-1.8-R0.1-SNAPSHOT.jar to D:\mc\spigotmc_build\.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - Saved as craftbukkit-1.8.jar&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Copying spigot-1.8-R0.1-SNAPSHOT-remapped.jar to D:\mc\spigotmc_build\.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - Saved as spigot-1.8.jar&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Copying spigot-1.8-R0.1-SNAPSHOT.jar to D:\mc\spigotmc_build\.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  - Saved as spigot-1.8.jar&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;相关文档&quot;&gt;&lt;a href=&quot;#相关文档&quot; class=&quot;headerlink&quot; title=&quot;相关文档&quot;&gt;&lt;/a&gt;相关文档&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.spigotmc.org/wiki/buildtools/&quot;&gt;buildtools帮助文档&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://hub.spigotmc.org/jenkins/job/BuildTools/lastSuccessfulBuild/artifact/target/BuildTools.jar&quot;&gt;BuildTool.jar下载地址&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;使用说明&quot;&gt;&lt;a href=&quot;#使用说明&quot; class=&quot;headerlink&quot; title=&quot;使用说明&quot;&gt;&lt;/a&gt;使用说明&lt;/h1&gt;&lt;p&gt;使用gitbash打开当前目录，输入&lt;code&gt;java -jar BuildTools.jar --rev 1.8&lt;/code&gt;,这里的1.8可以替换成其它版本，如1.10,1.10.2等。&lt;/p&gt;
&lt;h1 id=&quot;流程一，下载代码&quot;&gt;&lt;a href=&quot;#流程一，下载代码&quot; class=&quot;headerlink&quot; title=&quot;流程一，下载代码&quot;&gt;&lt;/a&gt;流程一，下载代码&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;克隆git代码&lt;a href=&quot;https://hub.spigotmc.org/stash/scm/spigot/bukkit.git&quot;&gt;bukkit&lt;/a&gt; 到 &lt;code&gt;bukkit&lt;/code&gt; 目录
    
    </summary>
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/categories/java/"/>
    
      <category term="minecraft" scheme="http://baba.zhaoxiuyuan.com/categories/java/minecraft/"/>
    
    
      <category term="minecraft" scheme="http://baba.zhaoxiuyuan.com/tags/minecraft/"/>
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>mc的部分代码研究</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/06/116_mc_code/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/06/116_mc_code/</id>
    <published>2017-06-28T08:50:28.000Z</published>
    <updated>2017-08-04T10:58:15.213Z</updated>
    
    <content type="html">&lt;h1 id=&quot;minecraft-server&quot;&gt;&lt;a href=&quot;#minecraft-server&quot; class=&quot;headerlink&quot; title=&quot;minecraft server&quot;&gt;&lt;/a&gt;minecraft server&lt;/h1&gt;&lt;p&gt;spigot服务器代码中，net.minecraft.server.v1_8_R3.PacketPlayOutPlayerInfo用来序列化玩家配置文件GameProfile给客户端的。&lt;br&gt;某次由于服务器返回的格式不符合要求，导致在使用了某种道具后导致了某个服务器崩溃。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;com-mojiang-authlib&quot;&gt;&lt;a href=&quot;#com-mojiang-authlib&quot; class=&quot;headerlink&quot; title=&quot;com.mojiang.authlib&quot;&gt;&lt;/a&gt;com.mojiang.authlib&lt;/h3&gt;&lt;p&gt;服务器和客户端共用代码，用来实现yggdrasil用户登录验证和用户Profile的获取。&lt;/p&gt;
&lt;p&gt;其中com/mojang/authlib/yggdrasil/YggdrasilMinecraftSessionService.java定义了所有使用到的url和资源域名白名单列表，直接更改此代码再重新打包成jar可改变客户端和服务器端的行为。&lt;/p&gt;
&lt;h2 id=&quot;spigot服务器&quot;&gt;&lt;a href=&quot;#spigot服务器&quot; class=&quot;headerlink&quot; title=&quot;spigot服务器&quot;&gt;&lt;/a&gt;spigot服务器&lt;/h2&gt;&lt;h3 id=&quot;入口&quot;&gt;&lt;a href=&quot;#入口&quot; class=&quot;headerlink&quot; title=&quot;入口&quot;&gt;&lt;/a&gt;入口&lt;/h3&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;spigot-1.7.x-1.8.1.jar!\org\bukkit\craftbukkit\Main&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-&amp;gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;net.minecraft.server.v1_7_R4.MinecraftServer.main(options1);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;其中MinecraftServer是纯净版服务器反编译的代码，而org\bukkit\craftbukkit\v1_7_R4\CraftServer是自已在反编译代码上封装的一层服务器接口。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;net-minecraft-server-v1-7-R4-LoginListener&quot;&gt;&lt;a href=&quot;#net-minecraft-server-v1-7-R4-LoginListener&quot; class=&quot;headerlink&quot; title=&quot;net.minecraft.server.v1_7_R4.LoginListener&quot;&gt;&lt;/a&gt;net.minecraft.server.v1_7_R4.LoginListener&lt;/h3&gt;&lt;p&gt;&lt;code&gt;public void a(PacketLoginInEncryptionBegin packetlogininencryptionbegin) {&lt;/code&gt;函数用来处理登录请求，在里开启线程向服务器验证登录(盗版服的情况下，直接在线程里fireLoginEvents声明登录成功)。&lt;/p&gt;
&lt;p&gt;1.7版本的spigot的实现是开启&lt;code&gt;ThreadPlayerLookupUUID&lt;/code&gt;线程类来验证登录。&lt;br&gt;1.8.8版本在此函数中直接开启匿名线程类，但里面的流程还是大致相同的，都是通过调用&lt;code&gt;LoginListener.this.server.aD().hasJoinedServer(...)&lt;/code&gt;来验证登录，这个&lt;code&gt;aD()&lt;/code&gt;返回的即是上面提到的&lt;code&gt;YggdrasilMinecraftSessionService&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;在hasJoinedServer里转调&lt;code&gt;net.minecraft.util.com.mojang.authlib.yggdrasil.YggdrasilAuthenticationService.makeRequest&lt;/code&gt;并指定链接来获取一个&lt;code&gt;HasJoinedMinecraftServerResponse&lt;/code&gt;格式的对象，这个对象的json原形在在mc的登录验证接口文档中有，就不再多说了。拿到Response后，hasJoinedServer使用Response构造出一个GameProfile并且返回，LoginListener将返回的GameProfile保存在成员变量i里。&lt;/p&gt;
&lt;p&gt;这里连接成功了就开始触发连接后处理流程，其中有一个工作流程是骑过LoginListener调用PlayerList然后通过上面提到的PacketPlayOutPlayerInfo构造一个包，并通过net.minecraft.server.v1_7_R4.PlayerConnection.SendPacket()加入到发送队列，最后发送出去。在网络发送时，调用PacketPlayOutPlayerInfo.b将这个packet序列化成二进制。&lt;/p&gt;
&lt;p&gt;但是在Spigot 1.7的，在packetdataserializer.version &amp;gt;= 20 这个分支才完整的输出了皮肤和披风等信息;在另外的分支里，只输出了name。通过&lt;a href=&quot;http://wiki.vg/Protocol_version_numbers中得到20版本号是介于1.7.10(version=5)和1.8版本(version=47)之间的某测试版本的版本号，所以对于老版本mc客户端应该是不会直接返回带Propertys的GameProfile的包。&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://wiki.vg/Protocol_version_numbers中得到20版本号是介于1.7.10(version=5)和1.8版本(version=47)之间的某测试版本的版本号，所以对于老版本mc客户端应该是不会直接返回带Propertys的GameProfile的包。&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;造成这种代码区别的原因是因为，在1.7.10也就是&lt;a href=&quot;http://wiki.vg/index.php?title=Protocol&amp;amp;oldid=6003#Player_List_Item&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;version为5的协议&lt;/a&gt;中用户列表中只有一种消息，只有三个字段Player name、Online、Ping。&lt;/p&gt;
&lt;p&gt;而在在&lt;a href=&quot;http://wiki.vg/index.php?title=Protocol&amp;amp;oldid=7368#Player_List_Item&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;47版本的协议&lt;/a&gt;中区分了更多的类型，里面添加了action并且提供对一组用户的通知。action为0(add player)的消息中附带有GameProfile中的Property的属性。&lt;/p&gt;
&lt;p&gt;在1.7.10之前版本应该是只能通过&lt;a href=&quot;http://wiki.vg/Mojang_API#UUID_-.3E_Profile_.2B_Skin.2FCape&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Mojang API#UUID -&amp;gt; Profile + Skin/Cape&lt;/a&gt;来请求皮肤和披风。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt; public void PacketPlayOutPlayerInfo.b(PacketDataSerializer packetdataserializer) throws IOException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if(packetdataserializer.version &amp;gt;= 20) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;         case 0:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                packetdataserializer.a(this.player.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                PropertyMap properties = this.player.getProperties();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                packetdataserializer.b(properties.size());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Iterator i$ = properties.values().iterator();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                while(i$.hasNext()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Property property = (Property)i$.next();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    packetdataserializer.a(property.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    packetdataserializer.a(property.getValue());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    packetdataserializer.writeBoolean(property.hasSignature());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    if(property.hasSignature()) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        packetdataserializer.a(property.getSignature());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; else &amp;#123;        &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        packetdataserializer.a(this.username);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        packetdataserializer.writeBoolean(this.action != 4);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        packetdataserializer.writeShort(this.ping);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;BungeeCord&quot;&gt;&lt;a href=&quot;#BungeeCord&quot; class=&quot;headerlink&quot; title=&quot;BungeeCord&quot;&gt;&lt;/a&gt;BungeeCord&lt;/h1&gt;&lt;h2 id=&quot;支持的客户端版本列表&quot;&gt;&lt;a href=&quot;#支持的客户端版本列表&quot; class=&quot;headerlink&quot; title=&quot;支持的客户端版本列表&quot;&gt;&lt;/a&gt;支持的客户端版本列表&lt;/h2&gt;&lt;p&gt;在&lt;code&gt;net.md_5.bungee.protocol.ProtocolConstants.java&lt;/code&gt;里定义了SUPPORTED_VERSION_IDS，如：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public static final List&amp;lt;String&amp;gt; SUPPORTED_VERSIONS = Arrays.asList(&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;quot;1.8.x&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;quot;1.9.x&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;quot;1.10.x&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;quot;1.11.x&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public static final List&amp;lt;Integer&amp;gt; SUPPORTED_VERSION_IDS = Arrays.asList( ProtocolConstants.MINECRAFT_1_8,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ProtocolConstants.MINECRAFT_1_9,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ProtocolConstants.MINECRAFT_1_9_1,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ProtocolConstants.MINECRAFT_1_9_2,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ProtocolConstants.MINECRAFT_1_9_4,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ProtocolConstants.MINECRAFT_1_10,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        ProtocolConstants.MINECRAFT_1_11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h2 id=&quot;正版登录验证&quot;&gt;&lt;a href=&quot;#正版登录验证&quot; class=&quot;headerlink&quot; title=&quot;正版登录验证&quot;&gt;&lt;/a&gt;正版登录验证&lt;/h2&gt;&lt;p&gt;在&lt;code&gt;net.md_5.bungee.connection.InitialHandler&lt;/code&gt;的&lt;code&gt;public void handle(EncryptionResponse encryptResponse)&lt;/code&gt;方法中，调用&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;精简版本代码：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;HttpClient.get(&amp;quot;https://sessionserver.mojang.com/session/minecraft/hasJoined?username=&amp;quot; + xxx,new Callback()&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  if (success)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;     ...&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;  else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      InitialHandler.this.disconnect(&amp;quot;给客户端的提示错误信息&amp;quot;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;   &amp;#125;   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;);&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h1 id=&quot;客户端&quot;&gt;&lt;a href=&quot;#客户端&quot; class=&quot;headerlink&quot; title=&quot;客户端&quot;&gt;&lt;/a&gt;客户端&lt;/h1&gt;&lt;h2 id=&quot;authlib&quot;&gt;&lt;a href=&quot;#authlib&quot; class=&quot;headerlink&quot; title=&quot;authlib&quot;&gt;&lt;/a&gt;authlib&lt;/h2&gt;&lt;p&gt;同上面服务器，只不过客户端的authlib是在.minecraft中的&lt;code&gt;.minecraft\libraries\com\mojang\authlib&lt;/code&gt;目录中，替换和原客户端相同的版本即可。&lt;/p&gt;
&lt;h3 id=&quot;皮肤和披风获取&quot;&gt;&lt;a href=&quot;#皮肤和披风获取&quot; class=&quot;headerlink&quot; title=&quot;皮肤和披风获取&quot;&gt;&lt;/a&gt;皮肤和披风获取&lt;/h3&gt;&lt;p&gt;服务器访问&lt;a href=&quot;http://wiki.vg/Protocol_Encryption#Server&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MojangAPi&lt;/a&gt;验证客户端登录后就有了皮肤和披风数据，然后加入缓存。&lt;/p&gt;
&lt;p&gt;1.8版本在登录成功后，服务器就会返回给客户端的Player_List_Item消息中就加入皮肤和披风数据，所以客户端可以直接展示自己及别人的皮肤。&lt;/p&gt;
&lt;p&gt;1.7以前版本的客户端，1.7版本通过Spawn Player通知某个玩家周围可见用户的皮肤数据。但自己的皮肤需要单独在YggdrasilMinecraftSessionService类的protected GameProfile fillGameProfile(GameProfile gameprofile, boolean flag) 方法中访问&lt;a href=&quot;http://wiki.vg/Mojang_API#UUID_-.3E_Profile_.2B_Skin.2FCape&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MojangApi&lt;/a&gt;来获取自己的皮肤数据，返回的结果跟服务器访问&lt;a href=&quot;http://wiki.vg/Protocol_Encryption#Server&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;MojangAPi&lt;/a&gt;得到的结果差不多。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;timestamp&amp;quot;: 1501839740,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;profileId&amp;quot;: &amp;quot;08d699bb6400355e981b678c9441fa75&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;profileName&amp;quot;: &amp;quot;k1988&amp;quot;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;signatureRequired&amp;quot;: false,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;quot;textures&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;quot;CAPE&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;quot;url&amp;quot;: &amp;quot;http://icon.mc.kuai8.com/cape/douyu.png&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;quot;SKIN&amp;quot;: &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;quot;url&amp;quot;: &amp;quot;http://icon.mc.kuai8.com/imshop/201708/20170803110431142.png&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h3 id=&quot;白名单&quot;&gt;&lt;a href=&quot;#白名单&quot; class=&quot;headerlink&quot; title=&quot;白名单&quot;&gt;&lt;/a&gt;白名单&lt;/h3&gt;&lt;p&gt;为了安全起见，皮肤和披风的链接都需要在YggdrasilMinecraftSessionService.isWhitelistedDomain中判断是否预定义的几个白名单网址。&lt;/p&gt;
&lt;h2 id=&quot;forge版本&quot;&gt;&lt;a href=&quot;#forge版本&quot; class=&quot;headerlink&quot; title=&quot;forge版本&quot;&gt;&lt;/a&gt;forge版本&lt;/h2&gt;&lt;h3 id=&quot;无敌模式&quot;&gt;&lt;a href=&quot;#无敌模式&quot; class=&quot;headerlink&quot; title=&quot;无敌模式&quot;&gt;&lt;/a&gt;无敌模式&lt;/h3&gt;&lt;p&gt;在编译spigot时反编译了net.minecraft.server.Entity的代码中，有一个函数&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public boolean damageEntity(DamageSource damagesource, float f) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (this.isInvulnerable(damagesource)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        this.ac();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在forge版本的&lt;code&gt;net.minecraft.entity.player.EntityPlayerMp&lt;/code&gt;的代码中，同样有一段类似但更复杂的函数,如果hook掉此函数的功能直接return false，即可实现无敌模式。&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;public boolean func_70097_a(DamageSource source, float amount) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if(this.func_180431_b(source)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        boolean flag = this.field_71133_b.func_71262_S() &amp;amp;&amp;amp; this.func_175400_cq() &amp;amp;&amp;amp; &amp;quot;fall&amp;quot;.equals(source.field_76373_n);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        if(!flag &amp;amp;&amp;amp; this.field_147101_bU &amp;gt; 0 &amp;amp;&amp;amp; source != DamageSource.field_76380_i) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            if(source instanceof EntityDamageSource) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                Entity entity = source.func_76346_g();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                if(entity instanceof EntityPlayer &amp;amp;&amp;amp; !this.func_96122_a((EntityPlayer)entity)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                if(entity instanceof EntityArrow) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    EntityArrow entityarrow = (EntityArrow)entity;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    if(entityarrow.field_70250_c instanceof EntityPlayer &amp;amp;&amp;amp; !this.func_96122_a((EntityPlayer)entityarrow.field_70250_c)) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                        return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            return super.func_70097_a(source, amount);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;皮肤性别选择&quot;&gt;&lt;a href=&quot;#皮肤性别选择&quot; class=&quot;headerlink&quot; title=&quot;皮肤性别选择&quot;&gt;&lt;/a&gt;皮肤性别选择&lt;/h3&gt;&lt;p&gt;游戏中默认皮肤是Steve还是Alex的选择方式。&lt;/p&gt;
&lt;p&gt;ref：&lt;a href=&quot;http://wiki.vg/Mojang_API#UUID_-.3E_Profile_.2B_Skin.2FCape&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://wiki.vg/Mojang_API#UUID_-.3E_Profile_.2B_Skin.2FCape&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;/*&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; * uuid的hashCode如果是奇数就是Alex，为偶数就是Steve&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;private static void printType(String uuid) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    UUID uid = UUID.fromString(uuid);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if ((uid.hashCode() &amp;amp; 1) != 0) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      System.out.println(uid.toString() + &amp;quot; = Alex&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      System.out.println(uid.toString() + &amp;quot; = Steve&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;minecraft-server&quot;&gt;&lt;a href=&quot;#minecraft-server&quot; class=&quot;headerlink&quot; title=&quot;minecraft server&quot;&gt;&lt;/a&gt;minecraft server&lt;/h1&gt;&lt;p&gt;spigot服务器代码中，net.minecraft.server.v1_8_R3.PacketPlayOutPlayerInfo用来序列化玩家配置文件GameProfile给客户端的。&lt;br&gt;某次由于服务器返回的格式不符合要求，导致在使用了某种道具后导致了某个服务器崩溃。&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/categories/java/"/>
    
      <category term="minecraft" scheme="http://baba.zhaoxiuyuan.com/categories/java/minecraft/"/>
    
    
      <category term="minecraft" scheme="http://baba.zhaoxiuyuan.com/tags/minecraft/"/>
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>Android RandomAccessFile模式</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/05/115_android_randomaccessfile/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/05/115_android_randomaccessfile/</id>
    <published>2017-05-03T08:50:28.000Z</published>
    <updated>2017-05-03T08:50:41.383Z</updated>
    
    <content type="html">&lt;p&gt;在项目中发现同一个文件（约500M），在浏览器和别的下载工具上使用http协议下载速度能达5M+KB/s，而我们的app中只能到6、700+KB/s。一开始以为是没有使用多线程下载，或者某逻辑代码是耗时操作，经过多次对比实验和调试，发现将下载时写文件用的&lt;code&gt;RandomAccessFile&lt;/code&gt;的构造函数中的参数&lt;code&gt;mode&lt;/code&gt;由&lt;code&gt;rwd&lt;/code&gt;改为&lt;code&gt;rw&lt;/code&gt;即可。&lt;/p&gt;
&lt;h3 id=&quot;RandomAccessFile的mode官方文档：&quot;&gt;&lt;a href=&quot;#RandomAccessFile的mode官方文档：&quot; class=&quot;headerlink&quot; title=&quot;RandomAccessFile的mode官方文档：&quot;&gt;&lt;/a&gt;&lt;code&gt;RandomAccessFile&lt;/code&gt;的&lt;code&gt;mode&lt;/code&gt;官方文档：&lt;/h3&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Value&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;Meaning&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;“r”&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;for reading only. Invoking any of the write methods of the resulting object will cause an IOException.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;“rw”&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Open for reading and writing. If the file does not already exist then an attempt will be made to create it.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;“rws”&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Open for reading and writing, as with “rw”, and also require that every update to the file’s content or metadata be written synchronously to the underlying storage device.&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;“rwd”&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Open for reading and writing, as with “rw”, and also require that every update to the file’s content be written synchronously to the underlying storage device.&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h3 id=&quot;参考：&quot;&gt;&lt;a href=&quot;#参考：&quot; class=&quot;headerlink&quot; title=&quot;参考：&quot;&gt;&lt;/a&gt;参考：&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.itpub.net/7437037/viewspace-977394/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.itpub.net/7437037/viewspace-977394/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/attilax/article/details/50881526&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/attilax/article/details/50881526&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在项目中发现同一个文件（约500M），在浏览器和别的下载工具上使用http协议下载速度能达5M+KB/s，而我们的app中只能到6、700+KB/s。一开始以为是没有使用多线程下载，或者某逻辑代码是耗时操作，经过多次对比实验和调试，发现将下载时写文件用的&lt;code&gt;Rand
    
    </summary>
    
      <category term="android" scheme="http://baba.zhaoxiuyuan.com/categories/android/"/>
    
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/tags/java/"/>
    
      <category term="android" scheme="http://baba.zhaoxiuyuan.com/tags/android/"/>
    
  </entry>
  
  <entry>
    <title>Android Studio：打包时出现xxx is not translated in xx</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/04/114_android_studio_translate/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/04/114_android_studio_translate/</id>
    <published>2017-04-20T03:20:28.000Z</published>
    <updated>2017-04-20T03:31:01.308Z</updated>
    
    <content type="html">&lt;p&gt;在某项目里用到了友盟的SDK，在打正式包时，友盟sdk里的很多资源文件编译出错，报错信息如下：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Error:(23) Error: &amp;quot;com_facebook_like_button_not_liked&amp;quot; is not translated in &amp;quot;ar&amp;quot; (Arabic), &amp;quot;cs&amp;quot; (Czech), &amp;quot;de&amp;quot; (German), &amp;quot;es&amp;quot; (Spanish), &amp;quot;fi&amp;quot; (Finnish), &amp;quot;fr&amp;quot; (French), &amp;quot;he&amp;quot; (Hebrew), &amp;quot;it&amp;quot; (Italian), &amp;quot;iw&amp;quot; (Hebrew), &amp;quot;ja&amp;quot; (Japanese), &amp;quot;ko&amp;quot; (Korean), &amp;quot;nl&amp;quot; (Dutch), &amp;quot;pl&amp;quot; (Polish), &amp;quot;pt&amp;quot; (Portuguese), &amp;quot;pt-BR&amp;quot; (Portuguese: Brazil), &amp;quot;ro&amp;quot; (Romanian), &amp;quot;ru&amp;quot; (Russian), &amp;quot;zh&amp;quot; (Chinese) [MissingTranslation]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;但其实最后apk也打出来了，虽然不知道为什么报错了还是能输出apk，但是还要想解决这个问题，经过搜索，找到以下解决方案。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;h2 id=&quot;解决方案一：&quot;&gt;&lt;a href=&quot;#解决方案一：&quot; class=&quot;headerlink&quot; title=&quot;解决方案一：&quot;&gt;&lt;/a&gt;解决方案一：&lt;/h2&gt;&lt;p&gt;在字符串资源文件里将&lt;code&gt;string&lt;/code&gt;结点添加一个属性&lt;code&gt;translatable=&amp;quot;false&amp;quot;&lt;/code&gt;，这种方法只适合数量较少的情况下。&lt;/p&gt;
&lt;h2 id=&quot;解决方案二：&quot;&gt;&lt;a href=&quot;#解决方案二：&quot; class=&quot;headerlink&quot; title=&quot;解决方案二：&quot;&gt;&lt;/a&gt;解决方案二：&lt;/h2&gt;&lt;p&gt;是用tools:ignore=”MissingTranslation“ 属性直接忽略这个问题。在字符资源文件里根结点&lt;code&gt;resource&lt;/code&gt;中下添加这么两个属性，就可以了&lt;br&gt;xmlns:tools=”&lt;a href=&quot;http://schemas.android.com/tools&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://schemas.android.com/tools&lt;/a&gt;“&lt;br&gt;tools:ignore=”MissingTranslation”。例：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;?xml version=&amp;quot;1.0&amp;quot; encoding=&amp;quot;utf-8&amp;quot;?&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;resources&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  xmlns:tools=&amp;quot;http://schemas.android.com/tools&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  tools:ignore=&amp;quot;MissingTranslation&amp;quot; &amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;lt;string name=&amp;quot;whatsapp_showword&amp;quot;&amp;gt;WhatsApp&amp;lt;/string&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/resources&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h2 id=&quot;解决方案三：&quot;&gt;&lt;a href=&quot;#解决方案三：&quot; class=&quot;headerlink&quot; title=&quot;解决方案三：&quot;&gt;&lt;/a&gt;解决方案三：&lt;/h2&gt;&lt;p&gt;在项目的builde.gralde里添加如下代码&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;android &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  lintOptions &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      checkReleaseBuilds false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      // Or, if you prefer, you can continue to check for errors in release builds,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      // but continue the build even when errors are found:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;      abortOnError false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;h3 id=&quot;参考资料&quot;&gt;&lt;a href=&quot;#参考资料&quot; class=&quot;headerlink&quot; title=&quot;参考资料&quot;&gt;&lt;/a&gt;参考资料&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.163.com/shexinyang@126/blog/static/136739312201492144928812/&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.163.com/shexinyang@126/blog/static/136739312201492144928812/&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.cnblogs.com/qinxianyuzou/p/3941661.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.cnblogs.com/qinxianyuzou/p/3941661.html&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://segmentfault.com/a/1190000000599530&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://segmentfault.com/a/1190000000599530&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在某项目里用到了友盟的SDK，在打正式包时，友盟sdk里的很多资源文件编译出错，报错信息如下：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Error:(23) Error: &amp;quot;com_facebook_like_button_not_liked&amp;quot; is not translated in &amp;quot;ar&amp;quot; (Arabic), &amp;quot;cs&amp;quot; (Czech), &amp;quot;de&amp;quot; (German), &amp;quot;es&amp;quot; (Spanish), &amp;quot;fi&amp;quot; (Finnish), &amp;quot;fr&amp;quot; (French), &amp;quot;he&amp;quot; (Hebrew), &amp;quot;it&amp;quot; (Italian), &amp;quot;iw&amp;quot; (Hebrew), &amp;quot;ja&amp;quot; (Japanese), &amp;quot;ko&amp;quot; (Korean), &amp;quot;nl&amp;quot; (Dutch), &amp;quot;pl&amp;quot; (Polish), &amp;quot;pt&amp;quot; (Portuguese), &amp;quot;pt-BR&amp;quot; (Portuguese: Brazil), &amp;quot;ro&amp;quot; (Romanian), &amp;quot;ru&amp;quot; (Russian), &amp;quot;zh&amp;quot; (Chinese) [MissingTranslation]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;...&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;但其实最后apk也打出来了，虽然不知道为什么报错了还是能输出apk，但是还要想解决这个问题，经过搜索，找到以下解决方案。&lt;br&gt;
    
    </summary>
    
      <category term="android" scheme="http://baba.zhaoxiuyuan.com/categories/android/"/>
    
    
      <category term="android" scheme="http://baba.zhaoxiuyuan.com/tags/android/"/>
    
      <category term="android studio" scheme="http://baba.zhaoxiuyuan.com/tags/android-studio/"/>
    
  </entry>
  
  <entry>
    <title>bat实例：用windows批处理将文件分组</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/03/113_bat_split/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/03/113_bat_split/</id>
    <published>2017-03-21T09:53:28.000Z</published>
    <updated>2017-03-21T09:53:22.735Z</updated>
    
    <content type="html">&lt;p&gt;上一次，使用bat来将txt文件给合并起来，而这次又有个小需求要将某目录下的大数量的指定类型文件（比如1w张图片，或者2w个xml）拆分到多个文件夹中。&lt;/p&gt;
&lt;p&gt;第一期先实现了个简单的按数量拆分的批处理文件，后面根据需求可以再过滤文件修改时间，文件名等（不过如果需求真的到了那么复杂，可能会换用python来写）。&lt;/p&gt;
&lt;p&gt;代码如下&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@echo off &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set usage=Usage：split_folder 源文件夹(可加通配符) 目标文件夹&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 待拆分的源文件夹&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set src=%1%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 拆分的目标文件夹&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set dest=%2%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 检查参数&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if &amp;#123;%src%&amp;#125; == &amp;#123;&amp;#125; echo &amp;quot;%usage%&amp;quot; &amp;amp;&amp;amp; goto end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if &amp;#123;%dest%&amp;#125; == &amp;#123;&amp;#125; echo &amp;quot;%usage%&amp;quot; &amp;amp;&amp;amp; goto end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 每一页条数&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set page_count=2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 起始页码&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set cur_page=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 起始页内索引&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set index=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;SETLOCAL ENABLEDELAYEDEXPANSION &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 循环处理列举出来的文件，如有特殊需求，可改下面的copy语句&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;for /f &amp;quot;delims=&amp;quot; %%i in (&amp;apos;dir /b /s /a-d %src%&amp;apos;) do (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    set /a index = !index! + 1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    set /a cur_page = !index! / %page_count%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if not exist %dest%\!cur_page! mkdir %dest%\!cur_page!&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    copy &amp;quot;%%i&amp;quot; &amp;quot;%dest%\!cur_page!\%%~nxi&amp;quot; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;)   &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;:end&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pause&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;上一次，使用bat来将txt文件给合并起来，而这次又有个小需求要将某目录下的大数量的指定类型文件（比如1w张图片，或者2w个xml）拆分到多个文件夹中。&lt;/p&gt;
&lt;p&gt;第一期先实现了个简单的按数量拆分的批处理文件，后面根据需求可以再过滤文件修改时间，文件名等（不过如果需求真的到了那么复杂，可能会换用python来写）。&lt;/p&gt;
&lt;p&gt;代码如下&lt;br&gt;
    
    </summary>
    
      <category term="系统/工具" scheme="http://baba.zhaoxiuyuan.com/categories/%E7%B3%BB%E7%BB%9F-%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="系统/工具" scheme="http://baba.zhaoxiuyuan.com/tags/%E7%B3%BB%E7%BB%9F-%E5%B7%A5%E5%85%B7/"/>
    
      <category term="bat" scheme="http://baba.zhaoxiuyuan.com/tags/bat/"/>
    
  </entry>
  
  <entry>
    <title>bat实例：用windows批处理合并txt文件</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/03/112_bat_merge/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/03/112_bat_merge/</id>
    <published>2017-03-07T02:23:28.000Z</published>
    <updated>2017-03-07T02:37:08.015Z</updated>
    
    <content type="html">&lt;p&gt;我有一堆小txt文本，想放在手机上阅读，但是在阅读器中切换文件比较烦，就写了个批处理把他们合并在一起成一个txt文件。&lt;/p&gt;
&lt;p&gt;示例中：将小文件全部放在&lt;code&gt;D:\mini&lt;/code&gt;文件夹中，然后将所有txt合并到&lt;code&gt;D:\mini_10k.txt&lt;/code&gt;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@echo off&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set dest=D:\mini_10k.txt&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set src=D:\mini&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo &amp;gt;%dest%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;for /r &amp;quot;%src%&amp;quot; %%i in (*.txt) do (&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 添加分割线&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo --------------------------------------- &amp;gt;&amp;gt; %dest%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 输出文件路径&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;echo %%i &amp;gt;&amp;gt; %dest%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 输出文件内容&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;type &amp;quot;%%i&amp;quot; &amp;gt;&amp;gt; %dest%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;)&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;我有一堆小txt文本，想放在手机上阅读，但是在阅读器中切换文件比较烦，就写了个批处理把他们合并在一起成一个txt文件。&lt;/p&gt;
&lt;p&gt;示例中：将小文件全部放在&lt;code&gt;D:\mini&lt;/code&gt;文件夹中，然后将所有txt合并到&lt;code&gt;D:\mini_10k.txt&lt;/code&gt;&lt;br&gt;
    
    </summary>
    
      <category term="系统/工具" scheme="http://baba.zhaoxiuyuan.com/categories/%E7%B3%BB%E7%BB%9F-%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="系统/工具" scheme="http://baba.zhaoxiuyuan.com/tags/%E7%B3%BB%E7%BB%9F-%E5%B7%A5%E5%85%B7/"/>
    
      <category term="bat" scheme="http://baba.zhaoxiuyuan.com/tags/bat/"/>
    
  </entry>
  
  <entry>
    <title>svn使用技巧：使用命令行添加忽略文件和目录</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/03/111_svn_ignore/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/03/111_svn_ignore/</id>
    <published>2017-03-03T03:40:28.000Z</published>
    <updated>2017-03-07T02:40:12.360Z</updated>
    
    <content type="html">&lt;p&gt;之前一直在团队中推荐自己在&lt;code&gt;TortoiseSVN&lt;/code&gt;的&lt;code&gt;Setting-&amp;gt;General-&amp;gt;Global ignore pattern&lt;/code&gt;中定义排除规则。比如，我一直用的是&lt;code&gt;*.o *.lo *.la *.al .libs *.so *.so.[0-9]* *.a *.pyc *.pyo __pycache__ *.rej *~ #*# .#* .*.swp .DS_Store [Tt]humbs.db&lt;/code&gt;。但有些人就不喜欢用，而且随着项目类型的转换，比如新的android团队需要定义不同的规则，这时就得重新在群里发新的规则比较麻烦。&lt;/p&gt;
&lt;p&gt;想到git项目中有.gitignore文件，就想svn中是否有一样的文件，寻找了一圈发现应该是没有类型的文件可以用，仅仅是在项目的svn Propertys设置对话框中在Edit时可以Load一个文件，这个文件的规则和.gitignore类似。&lt;/p&gt;
&lt;p&gt;顺便看到更改项目的svn:global-ignores和svn:ignore的命令行，就直接写了个批处理，外加三个规则文件&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;，在批处理里分别导入三个规则文件到svn属性里，然后在工程根目录执行后提交svn即可，然后同事们再add时就不容易带入垃圾文件了。&lt;/p&gt;
&lt;p&gt;批处理如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;@echo off&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 此批处理的用途&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 参考链接：http://stackoverflow.com/questions/17298668/svn-ignore-like-gitignore&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 参考命令行&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem svn propset svn:ignore -RF /root/svn-ignore.txt . [dot for current dir]&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem 各语言通用&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;set txt_path=%~dp0%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;svn propset svn:global-ignores -F &amp;quot;%txt_path%svn_ignored_common.txt&amp;quot; %cd%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem java开发&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;svn propset svn:global-ignores -F &amp;quot;%txt_path%\svn_ignored_java.txt&amp;quot; %cd%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rem android studio&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;svn propset svn:ignore -F &amp;quot;%txt_path%\svn_ignored_android_studio.txt&amp;quot; %cd%&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pause&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;具体的几个规则文件由于可能会经常变更，并且不同项目有不同的需求，在这里就只放个链接了，&lt;a href=&quot;https://github.com/k1988/win_mini_tool/tree/master/bats&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/k1988/win_mini_tool/tree/master/bats&lt;/a&gt;。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;之前一直在团队中推荐自己在&lt;code&gt;TortoiseSVN&lt;/code&gt;的&lt;code&gt;Setting-&amp;gt;General-&amp;gt;Global ignore pattern&lt;/code&gt;中定义排除规则。比如，我一直用的是&lt;code&gt;*.o *.lo *.la *.al .libs *.so *.so.[0-9]* *.a *.pyc *.pyo __pycache__ *.rej *~ #*# .#* .*.swp .DS_Store [Tt]humbs.db&lt;/code&gt;。但有些人就不喜欢用，而且随着项目类型的转换，比如新的android团队需要定义不同的规则，这时就得重新在群里发新的规则比较麻烦。&lt;/p&gt;
&lt;p&gt;想到git项目中有.gitignore文件，就想svn中是否有一样的文件，寻找了一圈发现应该是没有类型的文件可以用，仅仅是在项目的svn Propertys设置对话框中在Edit时可以Load一个文件，这个文件的规则和.gitignore类似。&lt;/p&gt;
&lt;p&gt;顺便看到更改项目的svn:global-ignores和svn:ignore的命令行，就直接写了个批处理，外加三个规则文件
    
    </summary>
    
      <category term="系统/工具" scheme="http://baba.zhaoxiuyuan.com/categories/%E7%B3%BB%E7%BB%9F-%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="系统/工具" scheme="http://baba.zhaoxiuyuan.com/tags/%E7%B3%BB%E7%BB%9F-%E5%B7%A5%E5%85%B7/"/>
    
      <category term="svn" scheme="http://baba.zhaoxiuyuan.com/tags/svn/"/>
    
  </entry>
  
  <entry>
    <title>Android Studio 使用技巧：修改默认build.gradle</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/02/110_as_templates/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/02/110_as_templates/</id>
    <published>2017-02-14T12:00:28.000Z</published>
    <updated>2017-03-07T02:40:07.544Z</updated>
    
    <content type="html">&lt;p&gt;在项目中发现一些好用的插件和库，就想默认在每个工程里使用，就想到了找找如何直接修改默认工程的build.gradle文件，经过多方面查找资料，可以使用下面的方法来改。&lt;/p&gt;
&lt;p&gt;比如说有一个好用的butterKnife这个库，需要添加buildscript的dependencies和compile的dependencies。&lt;/p&gt;
&lt;p&gt;我们先找到&lt;code&gt;Android Studio\plugins\android\lib\templates\gradle-projects&lt;/code&gt;，然后看名称就知道&lt;code&gt;NewAndroidProject&lt;/code&gt;目录下的就是创建android工程时默认使用的模板。&lt;/p&gt;
&lt;p&gt;然后我们打开&lt;code&gt;root&lt;/code&gt;&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;中的&lt;code&gt;build.gradle.ftl&lt;/code&gt;，看起来和一个默认项目里的结构一模一样，我们首先把&lt;code&gt;classpath &amp;#39;com.jakewharton:butterknife-gradle-plugin:8.5.1&amp;#39;&lt;/code&gt;添加在&lt;code&gt;buildscript.dependencies&lt;/code&gt;的最后面。同时，添加一个版本号字义(这一步也可以省略，如果省略，后面在app的gradle里就直接指定版本的&lt;code&gt;butterknife&lt;/code&gt;)以供在app的gradle里使用版本号变量来指定&lt;code&gt;butterknife&lt;/code&gt;，如下文中的&lt;code&gt;ext&lt;/code&gt;结点。&lt;/p&gt;
&lt;p&gt;如：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;buildscript &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    repositories &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        jcenter()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;#if mavenUrl != &amp;quot;mavenCentral&amp;quot;&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        maven &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            url &amp;apos;$&amp;#123;mavenUrl&amp;#125;&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/#if&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    dependencies &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        classpath &amp;apos;com.android.tools.build:gradle:$&amp;#123;gradlePluginVersion&amp;#125;&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // NOTE: Do not place your application dependencies here; they belong&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        // in the individual module build.gradle files&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        classpath &amp;apos;com.jakewharton:butterknife-gradle-plugin:8.5.1&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// Define versions in a single place&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;ext &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  // App dependencies&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  butterKnifeVersion = &amp;apos;8.5.1&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;但是我们在NewAndroidProject目录里并没有找到新建工程后的app目录里的那个build.gradle对应的模板，看名称找到了&lt;code&gt;NewAndroidModule&lt;/code&gt;目录，同样的步骤打开&lt;code&gt;root\build.gradle.ftl&lt;/code&gt;然后在&lt;code&gt;dependencies&lt;/code&gt;节点添加两行，结果见：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;dependencies &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compile fileTree(dir: &amp;apos;libs&amp;apos;, include: [&amp;apos;*.jar&amp;apos;])&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    androidTestCompile(&amp;apos;com.android.support.test.espresso:espresso-core:$&amp;#123;espressoVersion!&amp;quot;2.0&amp;quot;&amp;#125;&amp;apos;, &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        exclude group: &amp;apos;com.android.support&amp;apos;, module: &amp;apos;support-annotations&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;#if WearprojectName?has_content &amp;amp;&amp;amp; NumberOfEnabledFormFactors?has_content &amp;amp;&amp;amp; NumberOfEnabledFormFactors gt 1 &amp;amp;&amp;amp; Wearincluded&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    wearApp project(&amp;apos;:$&amp;#123;WearprojectName&amp;#125;&amp;apos;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compile &amp;apos;com.google.android.gms:play-services:+&amp;apos;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;lt;/#if&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // code generator for view(这3行是新增的)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    compile &amp;quot;com.jakewharton:butterknife:$rootProject.butterKnifeVersion&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    annotationProcessor &amp;quot;com.jakewharton:butterknife-compiler:$rootProject.butterKnifeVersion&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;然后保存文件，打开Android Stuido 新建工程。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;在项目中发现一些好用的插件和库，就想默认在每个工程里使用，就想到了找找如何直接修改默认工程的build.gradle文件，经过多方面查找资料，可以使用下面的方法来改。&lt;/p&gt;
&lt;p&gt;比如说有一个好用的butterKnife这个库，需要添加buildscript的dependencies和compile的dependencies。&lt;/p&gt;
&lt;p&gt;我们先找到&lt;code&gt;Android Studio\plugins\android\lib\templates\gradle-projects&lt;/code&gt;，然后看名称就知道&lt;code&gt;NewAndroidProject&lt;/code&gt;目录下的就是创建android工程时默认使用的模板。&lt;/p&gt;
&lt;p&gt;然后我们打开&lt;code&gt;root&lt;/code&gt;&lt;br&gt;
    
    </summary>
    
      <category term="android" scheme="http://baba.zhaoxiuyuan.com/categories/android/"/>
    
    
      <category term="android" scheme="http://baba.zhaoxiuyuan.com/tags/android/"/>
    
      <category term="gradle" scheme="http://baba.zhaoxiuyuan.com/tags/gradle/"/>
    
      <category term="Android Studio" scheme="http://baba.zhaoxiuyuan.com/tags/Android-Studio/"/>
    
  </entry>
  
  <entry>
    <title>NSIS 3.0 System Call 失败问题</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/02/109_NSIS3_system_call/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/02/109_NSIS3_system_call/</id>
    <published>2017-02-03T12:00:28.000Z</published>
    <updated>2017-03-07T02:39:48.415Z</updated>
    
    <content type="html">&lt;p&gt;以前一直用的是NSIS 2.x，但这些版本的NSIS打出来的安装包没有加声明系统兼容性的manifest，也不好用软件在打好的安装包上加manifest，所以就换用了最新版本的NSIS 3.0。&lt;/p&gt;
&lt;p&gt;换用3.0后之前正常的一些System::Call “xxx:xxx”函数失效了。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;先怀疑NSIS 3.0的System插件有问题，换成2.x的System插件，也还是解决不了问题。并且未能找到System.dll的源码。并且IDA反编译之，也未发现两者有什么关于加载库的区别。&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;p&gt;又怀疑是不是System语法问题，之前使用时直接没有加各种参数原型说明，也没有像文档一样使用参数列表和原型列表分开的调用方式。于是写了个Hello.dll,里面定义了个简单的Init函数，以及另外一个和MessageBox函数格式相同的 MyMessageBox函数。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;使用与调用 user32::MessageBox 相同的格式调用Hello:: MyMessageBox 依然未成功。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;使用ApiMonitor监控，发现LoadLibrary(“hello”)返回错误码126，即“模块未找到”。尝试将hello分别放在与 安装包同目录，系统目录，在环境变量PATH里的非系统目录，结果只有放在系统目录下才调用成功。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;使用不同的系统来测试，win7、xp无此问题。win8与win10一样有此问题。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;使用c++编写一个简单的代码测试来加载NSIS加载不了的dll，也是可以加载的&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;最后使用全路径临时解决此问题。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Function .onInit&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  StrCpy $InstallSuccess 0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  Call CheckMutex&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  InitPluginsDir&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  SetOutPath $PLUGINSDIR&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  System::Call &amp;apos;user32::MessageBox(p, t, t, i) i (0, &amp;quot;123&amp;quot;, &amp;quot;System Example 2&amp;quot;, $&amp;#123;MB_OKCANCEL&amp;#125;)&amp;apos; &amp;quot;$7&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  file &amp;quot;hello.dll&amp;quot;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  System::Call &amp;apos;hello::Init()&amp;apos; # 失败&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  System::Call /NOUNLOAD &amp;apos;hello::Init()&amp;apos; # 失败&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;  System::Call &amp;apos;$PLUGINSDIR\hello::MyMessageBox(p, t, t, i) i (0, &amp;quot;123&amp;quot;, &amp;quot;System Example 2&amp;quot;, $&amp;#123;MB_OKCANCEL&amp;#125;)&amp;apos; &amp;quot;$7&amp;quot; #成功&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;以前一直用的是NSIS 2.x，但这些版本的NSIS打出来的安装包没有加声明系统兼容性的manifest，也不好用软件在打好的安装包上加manifest，所以就换用了最新版本的NSIS 3.0。&lt;/p&gt;
&lt;p&gt;换用3.0后之前正常的一些System::Call “xxx:xxx”函数失效了。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;先怀疑NSIS 3.0的System插件有问题，换成2.x的System插件，也还是解决不了问题。并且未能找到System.dll的源码。并且IDA反编译之，也未发现两者有什么关于加载库的区别。
    
    </summary>
    
    
      <category term="bugs" scheme="http://baba.zhaoxiuyuan.com/tags/bugs/"/>
    
      <category term="NSIS" scheme="http://baba.zhaoxiuyuan.com/tags/NSIS/"/>
    
  </entry>
  
  <entry>
    <title>java重新入坑</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/01/java%E9%87%8D%E6%96%B0%E5%85%A5%E5%9D%91/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/01/java重新入坑/</id>
    <published>2017-01-11T09:49:48.000Z</published>
    <updated>2017-08-04T01:44:58.565Z</updated>
    
    <content type="html">&lt;p&gt;毕业八年了，从毕业后就没有写过java代码，仅平常看看android相关的资讯和博客及时不时编译下Android工程，以前学过的java早忘光了。&lt;/p&gt;
&lt;p&gt;最近因工作需要要重新学习下java，结果上来就踩一坑。&lt;/p&gt;
&lt;h1 id=&quot;第一坑&quot;&gt;&lt;a href=&quot;#第一坑&quot; class=&quot;headerlink&quot; title=&quot;第一坑&quot;&gt;&lt;/a&gt;第一坑&lt;/h1&gt;&lt;p&gt;更新于：2016-07-06&lt;/p&gt;
&lt;p&gt;很简单一事，随便抄了个&lt;code&gt;Property.java&lt;/code&gt;，想着怎么执行呢，按着&lt;code&gt;python、lua、php、nodejs&lt;/code&gt;类型的方式&lt;code&gt;java Property.java&lt;/code&gt;,呕妹糕，&lt;code&gt;找不到或无法加载主类 Property.java&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;查询网站，原谅我已经忘记了命令行执行java程序是需要先编译一下下的，找到&lt;code&gt;javac.exe&lt;/code&gt;执行后生成了&lt;code&gt;Property.class&lt;/code&gt;，然后&lt;code&gt;java Propery&lt;/code&gt;，又报错&lt;code&gt;找不到或无法加载主类 Property&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;why？why？都有class了还不给执行？&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;查访网络后发现虽然我机器上被各种情况装了各种java环境，可是PATH和CLASS_PATH都没有正确的被设置。&lt;/p&gt;
&lt;p&gt;添加环境变量&lt;code&gt;CLASSPATH=.;%JAVA_HOME%\lib\dt.jar;%JAVA_HOME%\lib\tools.jar;&lt;/code&gt;及&lt;code&gt;PATH=%PATH%;.;%JAVA_HOME%\bin;&lt;/code&gt;后再执行，终于正常了。   &lt;/p&gt;
&lt;h1 id=&quot;jar中没有主清单属性&quot;&gt;&lt;a href=&quot;#jar中没有主清单属性&quot; class=&quot;headerlink&quot; title=&quot;jar中没有主清单属性&quot;&gt;&lt;/a&gt;jar中没有主清单属性&lt;/h1&gt;&lt;p&gt;ref: &lt;a href=&quot;http://jingyan.baidu.com/article/db55b60990f6084ba30a2fb8.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://jingyan.baidu.com/article/db55b60990f6084ba30a2fb8.html&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;验证一个java特性instrument时，将代码打包成jar包，在&lt;code&gt;manifest.md&lt;/code&gt;里只使用了&lt;code&gt;Premain-Class&lt;/code&gt;属性。但是在随后尝试直接启动时，未添加&lt;code&gt;Main-Class&lt;/code&gt;属性。&lt;/p&gt;
&lt;h1 id=&quot;第二坑&quot;&gt;&lt;a href=&quot;#第二坑&quot; class=&quot;headerlink&quot; title=&quot;第二坑&quot;&gt;&lt;/a&gt;第二坑&lt;/h1&gt;&lt;p&gt;windows上正常的java程序，放到linux上编译失败。报错&lt;code&gt;error: unmappable character for encoding ASCII&lt;/code&gt;&lt;br&gt;原因是windows上默认编码是我中文系统的gbk编码，而linux上出现编码不一致时需要在命令行中指定:&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;编译时：javac -encoding gbk test.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;运行时：java  -Dfile.encoding=gbk test&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;当然，编码视不同情况可指定为utf-8等其它编码。&lt;/p&gt;
&lt;p&gt;如果编码统一，则可以在环境变量中指定&lt;code&gt;export JAVA_TOOL_OPTIONS=-Dfile.encoding=UTF8&lt;/code&gt;,如果在在~/.bashrc文件里添加,就不用每次手动再改了!&lt;/p&gt;
&lt;h1 id=&quot;第三坑-Could-not-reserve-enough-space&quot;&gt;&lt;a href=&quot;#第三坑-Could-not-reserve-enough-space&quot; class=&quot;headerlink&quot; title=&quot;第三坑 Could not reserve enough space&quot;&gt;&lt;/a&gt;第三坑 Could not reserve enough space&lt;/h1&gt;&lt;p&gt;2017-01-11更新&lt;/p&gt;
&lt;p&gt;编译某一项目时，该项目编译时提示错误：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;Error:Unable to start the daemon process.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;This problem might be caused by incorrect configuration of the daemon.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;For example, an unrecognized jvm option is used.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Please refer to the user guide chapter on the daemon at https://docs.gradle.org/3.1/userguide/gradle_daemon.html&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Please read the following process output to find out more:&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;-----------------------&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Error occurred during initialization of VM&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Could not reserve enough space for 2621440KB object heap&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Java HotSpot(TM) Client VM warning: ignoring option MaxPermSize=1024m; support was removed in 8.0&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;是因为&lt;code&gt;gradle.properties&lt;/code&gt;中有一行&lt;code&gt;org.gradle.jvmargs=-Xmx2560m -XX:MaxPermSize=1024m&lt;/code&gt;，导致构建时java.exe报错。&lt;br&gt;直接使用命令行&lt;code&gt;java -Xmx(n)M -version&lt;/code&gt;测试，发现在我的机器上最大只能到&lt;code&gt;java -Xmx1256M -version&lt;/code&gt;，再研究研究，发现这是个32位的java，换用 &lt;strong&gt;64位jdk&lt;/strong&gt;解决之。&lt;/p&gt;
&lt;h1 id=&quot;其它坑待更新&quot;&gt;&lt;a href=&quot;#其它坑待更新&quot; class=&quot;headerlink&quot; title=&quot;其它坑待更新&quot;&gt;&lt;/a&gt;其它坑待更新&lt;/h1&gt;</content>
    
    <summary type="html">
    
      &lt;p&gt;毕业八年了，从毕业后就没有写过java代码，仅平常看看android相关的资讯和博客及时不时编译下Android工程，以前学过的java早忘光了。&lt;/p&gt;
&lt;p&gt;最近因工作需要要重新学习下java，结果上来就踩一坑。&lt;/p&gt;
&lt;h1 id=&quot;第一坑&quot;&gt;&lt;a href=&quot;#第一坑&quot; class=&quot;headerlink&quot; title=&quot;第一坑&quot;&gt;&lt;/a&gt;第一坑&lt;/h1&gt;&lt;p&gt;更新于：2016-07-06&lt;/p&gt;
&lt;p&gt;很简单一事，随便抄了个&lt;code&gt;Property.java&lt;/code&gt;，想着怎么执行呢，按着&lt;code&gt;python、lua、php、nodejs&lt;/code&gt;类型的方式&lt;code&gt;java Property.java&lt;/code&gt;,呕妹糕，&lt;code&gt;找不到或无法加载主类 Property.java&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;查询网站，原谅我已经忘记了命令行执行java程序是需要先编译一下下的，找到&lt;code&gt;javac.exe&lt;/code&gt;执行后生成了&lt;code&gt;Property.class&lt;/code&gt;，然后&lt;code&gt;java Propery&lt;/code&gt;，又报错&lt;code&gt;找不到或无法加载主类 Property&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;why？why？都有class了还不给执行？
    
    </summary>
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/categories/java/"/>
    
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/tags/java/"/>
    
      <category term="bugs" scheme="http://baba.zhaoxiuyuan.com/tags/bugs/"/>
    
  </entry>
  
  <entry>
    <title>那些想哭的bug（一）</title>
    <link href="http://baba.zhaoxiuyuan.com/2017/01/108_human_bug_1/"/>
    <id>http://baba.zhaoxiuyuan.com/2017/01/108_human_bug_1/</id>
    <published>2017-01-03T12:00:28.000Z</published>
    <updated>2017-08-04T01:45:45.821Z</updated>
    
    <content type="html">&lt;h1 id=&quot;前提&quot;&gt;&lt;a href=&quot;#前提&quot; class=&quot;headerlink&quot; title=&quot;前提&quot;&gt;&lt;/a&gt;前提&lt;/h1&gt;&lt;p&gt;在这些年公司和个人的项目中，有些bug在没有找到根本原因之前，会觉得真的是不可思议，各种排除各种测试都未解决或干脆就未复现。&lt;br&gt;但是当某天在查找其它问题/添加新的功能/优化代码/睡觉时，突然发现/想到根本原因之后，简直想哭。。问题可能出现在一个很不起眼/一扫而过/觉得100%不会有问题的地方。&lt;/p&gt;
&lt;p&gt;今天就遇到一个这样的bug，无语的让我想专门开个类别存放这类bug。&lt;/p&gt;
&lt;p&gt;前提条件是这样的，主程序A在运行过程中，会从服务器上拉取一些推(la)荐(ji)信(guang)息(gao),然后在不同的条件下启动程序B来显示。A和B都经常多年多个版本的迭代，加了不同类型的广告，有2种最常用的是：&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;弹窗推荐：A启动后，拉取推荐信息，下载资源，指定时间点或指定分钟数后，启动B在右下角弹窗推荐我们软件中的游戏。&lt;/li&gt;
&lt;li&gt;托盘推荐：A启动后，拉取推荐信息，下载资源，指定时间点或指定分钟数后，启动B在在托盘区域弹窗显示个图标，点击后打开我们软件中的游戏。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;有一个版本，boss看到别的程序经常在退出后还会再弹出一个窗口来推荐信息（如免费版本的winrar），就拍板添加了个功能： A启动后，拉取推荐信息，下载资源，在 &lt;strong&gt;A程序退出后&lt;/strong&gt;居中显示一张图片（有关闭按钮，倒计时），用户点击图片后打开我们推荐的网址。&lt;/p&gt;
&lt;p&gt;我们的各种推荐的到达率都是有数据统计的，点击转换率也是有数据统计的，但这个功能上线后发现居然有 &lt;em&gt;50%左右&lt;/em&gt; 的用户请求了广告，但是没有显示出来退出广告。于是乎各种分析A程序的流程（推荐信息是否拉取失败，信息解析是否可能失败，需要显示的图片资源是否可能失败，启动B程序是否可能失败，是否有安全软件拦截）、统计服务器的统计代码、统计分析服务器的代码都没有发现原因；在测试部门测试、复测时也没有发现请求了广告但是退出时不显示的问题。&lt;/p&gt;
&lt;p&gt;在其它广告的数据中，也偶有丢失个10%左右的情况，但这种50%级别的丢失，实在是难以想像哪儿出了问题，百思不得其解后，也只能先暂停掉这个类型的推荐信息。然后几个月过去了，这事儿就抛在脑后了。&lt;/p&gt;
&lt;h1 id=&quot;神之复现&quot;&gt;&lt;a href=&quot;#神之复现&quot; class=&quot;headerlink&quot; title=&quot;神之复现&quot;&gt;&lt;/a&gt;神之复现&lt;/h1&gt;&lt;p&gt;在今天，因为有个产品，我们将A和B复制并改动出了C和D，然后在走测试流程。有一个测试在测试时向我汇报，她机器上的这种类型的推荐信息偶尔不显示。&lt;br&gt;由于程序员普遍的自负心理，我想我就是A和B简单的复制，稍微改动成的C和D，怎么可能这个功能有问题呢，肯定是测试她自己在测试环境上配置错了，或者某些条件不满足。然后很不耐烦地过去瞅瞅状况，经过她几次反复的演示，我觉得至少在她那儿是有些什么情况，确实是有不显示的问题。&lt;br&gt;先一一排除掉A的信息拉取（WireShark抓包没有问题）正常，资源下载正常（资源目录里有图片），配置后台中的其它信息也一一验证是合法的，然后用 &lt;code&gt;ProcMon.exe&lt;/code&gt; 监控发现不显示广告时，D程序都是创建后很快就退出了。&lt;/p&gt;
&lt;p&gt;于是将命令行拷贝到我测试机上，然后用VS Debug运行，发现一切又很正常。&lt;/p&gt;
&lt;h1 id=&quot;神之谜底&quot;&gt;&lt;a href=&quot;#神之谜底&quot; class=&quot;headerlink&quot; title=&quot;神之谜底&quot;&gt;&lt;/a&gt;神之谜底&lt;/h1&gt;&lt;p&gt;经过几分钟的测试，在Debug和Release、及发行版本的行为对比，发现了一处代码是问题的根源。&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;在B的入口处：&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	// 查找A程序主窗口&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	HWND hWnd = FindWindow(A程序主窗口类名, A程序标题);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (!hWnd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#ifndef _DEBUG&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		return FALSE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#endif // _DEBUG&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;因为之前的广告的行为基本上都是A启动B，B就单独存在，当用户点击推荐信息时，将动作发送给A，让A来执行。如果A不存在了，就使用命令行启动A来处理。&lt;br&gt;但新加的那个退出推荐的逻辑是，在A的主窗口的&lt;code&gt;OnClose&lt;/code&gt;事件里启动B程序来显示广告信息，但执行顺序存在随机性，有可能是B先启动，然后走到FindWindow，也有可能是A程序的窗口先OnDestory掉，B再走到FindWindow。所以，在所有的用户环境那边，就出现了50%左右的丢失率（如果两边的执行代码区别再大一些，可能是别的百分比）。&lt;/p&gt;
&lt;p&gt;而解决办法显而易见，退出推荐时根本不需要检测A窗口是否存在，后续的用户行为反应也是不需要再启动A来执行的。在if (!hWnd) 条件中再加上广告类型的判断即可解决。&lt;/p&gt;
&lt;h1 id=&quot;迷之羞愧&quot;&gt;&lt;a href=&quot;#迷之羞愧&quot; class=&quot;headerlink&quot; title=&quot;迷之羞愧&quot;&gt;&lt;/a&gt;迷之羞愧&lt;/h1&gt;&lt;p&gt;如果倒着看这个博客，一定会嗤之以鼻：如此简单的问题都找不到。 但反想一下，这个bug是一个随机现象，且不能稳定重现，且bug触发的原因隐藏在多年表现正常的的代码中，这都导致了问题没有很快的解决（ &lt;em&gt;甩锅干脆利落&lt;/em&gt;）。&lt;/p&gt;
&lt;p&gt;其实嘛，经过多年的项目经验，确实印证了一句话 &lt;strong&gt;事出反常必有妖&lt;/strong&gt;，就是当用户出现了不正常的情况，虽然大部分情况下会不由自主的指责别人使用方法不对，但往确实是自己的程序出现了或多或少的考虑不周或者是隐藏的问题导致的。只不过，有些bug换种使用流程和环境就绕过去了（比如：万能的重启），有些bug总是会在不经意间蹦出来咬你一口。&lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前提&quot;&gt;&lt;a href=&quot;#前提&quot; class=&quot;headerlink&quot; title=&quot;前提&quot;&gt;&lt;/a&gt;前提&lt;/h1&gt;&lt;p&gt;在这些年公司和个人的项目中，有些bug在没有找到根本原因之前，会觉得真的是不可思议，各种排除各种测试都未解决或干脆就未复现。&lt;br&gt;但是当某天在查找其它问题/添加新的功能/优化代码/睡觉时，突然发现/想到根本原因之后，简直想哭。。问题可能出现在一个很不起眼/一扫而过/觉得100%不会有问题的地方。&lt;/p&gt;
&lt;p&gt;今天就遇到一个这样的bug，无语的让我想专门开个类别存放这类bug。&lt;/p&gt;
&lt;p&gt;前提条件是这样的，主程序A在运行过程中，会从服务器上拉取一些推(la)荐(ji)信(guang)息(gao),然后在不同的条件下启动程序B来显示。A和B都经常多年多个版本的迭代，加了不同类型的广告，有2种最常用的是：&lt;br&gt;
    
    </summary>
    
      <category term="随笔" scheme="http://baba.zhaoxiuyuan.com/categories/%E9%9A%8F%E7%AC%94/"/>
    
    
      <category term="bugs" scheme="http://baba.zhaoxiuyuan.com/tags/bugs/"/>
    
  </entry>
  
  <entry>
    <title>使用百度输入法时程序崩溃</title>
    <link href="http://baba.zhaoxiuyuan.com/2016/11/107_baidupingyin_crash/"/>
    <id>http://baba.zhaoxiuyuan.com/2016/11/107_baidupingyin_crash/</id>
    <published>2016-11-24T06:20:28.000Z</published>
    <updated>2017-03-07T02:39:27.719Z</updated>
    
    <content type="html">&lt;p&gt;使用4.0.3187.0版本的百度拼音输入法时，启动我司的快吧游戏软件，再退出快吧，程序崩溃。查看消息结构体，窗口目标句柄在spy++里已经搜索不到，崩溃地址在某台机器上是0x690eb410。&lt;/p&gt;
&lt;p&gt;重启后加汇编断点后发现，该模块地址是百度的uipfull.dll中，父调用者是user32.dll!__InternalCallWinProc@20()。而该窗口的类名是CMessenger_Wnd，样式是CS_IME。&lt;/p&gt;
&lt;p&gt;猜测在某种环境下，&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;百度输入法在uipfull模板释放时，并未将输入法窗口的WndProc修改成原来的函数，并且还触发了自定义消息？&lt;br&gt;导致分发消息时，试图尝试调用窗口的wndProc属性指定的消息处理函数，导致崩溃。&lt;/p&gt;
&lt;img title=&quot;程序崩溃&quot; alt=&quot;程序崩溃&quot; src=&quot;http://o9tn2674s.bkt.clouddn.com/static/images/107_crash.png-k1988&quot;&gt; </content>
    
    <summary type="html">
    
      &lt;p&gt;使用4.0.3187.0版本的百度拼音输入法时，启动我司的快吧游戏软件，再退出快吧，程序崩溃。查看消息结构体，窗口目标句柄在spy++里已经搜索不到，崩溃地址在某台机器上是0x690eb410。&lt;/p&gt;
&lt;p&gt;重启后加汇编断点后发现，该模块地址是百度的uipfull.dll中，父调用者是user32.dll!__InternalCallWinProc@20()。而该窗口的类名是CMessenger_Wnd，样式是CS_IME。&lt;/p&gt;
&lt;p&gt;猜测在某种环境下，
    
    </summary>
    
      <category term="windows" scheme="http://baba.zhaoxiuyuan.com/categories/windows/"/>
    
    
      <category term="windows" scheme="http://baba.zhaoxiuyuan.com/tags/windows/"/>
    
      <category term="shell" scheme="http://baba.zhaoxiuyuan.com/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>windows托盘图标检测</title>
    <link href="http://baba.zhaoxiuyuan.com/2016/11/106_windows%E6%89%98%E7%9B%98%E5%9B%BE%E6%A0%87%E6%A3%80%E6%B5%8B/"/>
    <id>http://baba.zhaoxiuyuan.com/2016/11/106_windows托盘图标检测/</id>
    <published>2016-11-10T07:20:28.000Z</published>
    <updated>2017-03-07T02:39:24.288Z</updated>
    
    <content type="html">&lt;p&gt;由于业务需要，研究一下如何用程序判断右下角拖盘中某图标在什么时候隐藏到溢出区。经过多方资料查找，最终输出可用代码。支持windows xp至windows 10的32位和64位下的图标检测。&lt;/p&gt;
&lt;p&gt;32位程序中读取64位explorer进程中的信息时，网上大多只给出了32位的结构体定义，所以根据调试时查看内存分布，调整了下64位的结构体。&lt;/p&gt;
&lt;p&gt;代码如下：&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;87&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;88&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;89&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;90&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;91&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;92&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;93&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;94&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;95&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;96&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;97&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;98&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;99&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;100&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;101&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;102&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;103&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;104&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;105&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;106&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;107&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;108&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;109&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;110&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;111&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;112&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;113&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;114&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;115&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;116&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;117&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;118&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;119&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;120&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;121&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;122&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;123&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;124&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;125&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;126&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;127&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;128&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;129&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;130&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;131&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;132&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;133&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;134&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;135&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;136&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;137&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;138&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;139&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;140&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;141&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;142&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;143&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;144&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;145&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;146&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;147&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;148&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;149&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;150&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;151&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;152&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;153&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;154&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;155&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;156&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;157&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;158&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;159&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;160&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;161&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;162&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;163&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;164&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;165&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;166&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;167&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;168&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;169&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;170&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;171&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;172&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;173&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;174&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;175&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;176&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;177&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;178&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;179&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;180&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;181&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;typedef struct TBBUTTON64 &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	int iBitmap;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	int idCommand;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	BYTE fsState;	// TBSTATE_CHECKED 等&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	BYTE fsStyle;	// TBSTYLE_BUTTON 等&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	BYTE bReserved[6];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	int64_t dwData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	int64_t iString;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	BYTE test[100];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; ;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;struct TRAYDATA64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	int64_t hWnd;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	uint32_t uID;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	uint32_t uCallbackMessage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	uint32_t Reserved1[2];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	int64_t hIcon;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	uint32_t Reserved2[4];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	TCHAR szExePath[MAX_PATH];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	TCHAR szTip[128]; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;struct TRAYDATA32 &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	HWND hwnd;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	UINT uID;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	UINT uCallbackMessage;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	DWORD Reserved[2];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	HICON hIcon;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	DWORD Reserved2[3];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	TCHAR szExePath[MAX_PATH];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	TCHAR szTip[128]; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;bool IsWow64ProcessEx( HANDLE hProcess )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	/*判断ntdll中的导出函数,可知是否是64位OS*/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	HMODULE hMod = GetModuleHandle(_T(&amp;quot;ntdll.dll&amp;quot;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	FARPROC x64fun = ::GetProcAddress(hMod,&amp;quot;ZwWow64ReadVirtualMemory64&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if(!x64fun) &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	/*利用IsWow64Process判断是否是x64进程*/&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	typedef BOOL(WINAPI *pfnIsWow64Process)(HANDLE,PBOOL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pfnIsWow64Process fnIsWow64Process = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	hMod = GetModuleHandle(_T(&amp;quot;kernel32.dll&amp;quot;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	fnIsWow64Process = (pfnIsWow64Process)GetProcAddress(hMod,&amp;quot;IsWow64Process&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if(!fnIsWow64Process) //如果没有导出则判定为32位&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	BOOL bX64;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if(!fnIsWow64Process(hProcess, &amp;amp;bX64))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	return !bX64;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;template&amp;lt;typename BUTTONTYPE, typename TRAYDATA_TYPE&amp;gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;void EnumIcons(size_t buttonNumber, HANDLE hProcess, LPVOID pAddress, HWND hWnd)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	for( int i=0; i&amp;lt; buttonNumber; i++ )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		long lRet = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		// 读取图标结构体&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		BUTTONTYPE buttonInfo = &amp;#123;0&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		DWORD dwBytes = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		::WriteProcessMemory(hProcess, pAddress, &amp;amp;buttonInfo, sizeof(buttonInfo), &amp;amp;dwBytes);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		lRet = ::SendMessage( hWnd, TB_GETBUTTON, i, long(pAddress) );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		lRet = ReadProcessMemory( hProcess, pAddress, &amp;amp;buttonInfo, sizeof(buttonInfo), &amp;amp;dwBytes);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		// 读取TrayData&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		TRAYDATA_TYPE trayData;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		lRet =  ::ReadProcessMemory(hProcess, (LPVOID)buttonInfo.dwData, &amp;amp;trayData, sizeof(trayData), NULL);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		// 方法1. 直接从ButtonInfo成员的string地址读取图标标题&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		TCHAR szTips[1024];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		::ReadProcessMemory(hProcess, (void*)(buttonInfo.iString),szTips, 1024, &amp;amp;dwBytes);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		OutputDebugString(szTips);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		// 方法2. 从TrayData中读取图标标题和程序路径&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		OutputDebugString(trayData.szTip);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		OutputDebugString(trayData.szExePath);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		// 方法3. 发送消息，读取图标标题&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		SendMessage(hWnd, TB_GETBUTTONTEXT, buttonInfo.idCommand, LPARAM(LPARAM(pAddress) + sizeof(buttonInfo)));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		::ReadProcessMemory(hProcess, (void*)(LPARAM(pAddress) + sizeof(buttonInfo)),szTips, 1024, &amp;amp;dwBytes);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		OutputDebugString(szTips);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// 判断在通知区域是否有托盘图标&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BOOL IsTrayIconExsitInNotifyArea()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	HWND hWnd = NULL, hWndPager = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	unsigned long ulPID = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	long lRet = 0, lButtons = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	HANDLE hProcess = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	LPVOID pAddress = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	long lTextAdr = 0, lHwndAdr = 0, lHwnd = 0, lButtonID = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	char strBuff[1024] = &amp;#123; 0 &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	char_t *pStr = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	char *pTemp = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	hWnd = ::FindWindow( _T(&amp;quot;Shell_TrayWnd&amp;quot;), NULL );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	hWnd = ::FindWindowEx( hWnd, 0, _T(&amp;quot;TrayNotifyWnd&amp;quot;), NULL );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	hWndPager = ::FindWindowEx( hWnd, 0, _T(&amp;quot;SysPager&amp;quot;), NULL );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if( hWndPager == NULL )&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		hWnd = ::FindWindowEx( hWnd, 0, _T(&amp;quot;ToolbarWindow32&amp;quot;), NULL ); // 对于Win2000，没有SysPager窗口&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		hWnd = ::FindWindowEx( hWndPager, 0, _T(&amp;quot;ToolbarWindow32&amp;quot;), NULL );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	lRet = GetWindowThreadProcessId( hWnd, &amp;amp;ulPID );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	hProcess = OpenProcess(PROCESS_ALL_ACCESS|PROCESS_VM_OPERATION|PROCESS_VM_READ|PROCESS_VM_WRITE, 0, ulPID );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pAddress = VirtualAllocEx( hProcess, 0, 0x4096, MEM_COMMIT, PAGE_READWRITE );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	lButtons = ::SendMessage( hWnd, TB_BUTTONCOUNT, 0, 0 );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (IsWow64ProcessEx(hProcess))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		EnumIcons&amp;lt;TBBUTTON64, TRAYDATA64&amp;gt;(lButtons, hProcess, pAddress, hWnd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		EnumIcons&amp;lt;TBBUTTON, TRAYDATA32&amp;gt;(lButtons, hProcess, pAddress, hWnd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	VirtualFreeEx( hProcess, pAddress, 0X4096, MEM_RELEASE );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	CloseHandle( hProcess );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	return FALSE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;// 判断在托盘溢出区域是否有托盘图标&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;BOOL IsTrayIconExsitInOverflowWindow()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	HWND hWnd = NULL, hWndPager = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	unsigned long ulPID = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	long lRet = 0, lButtons = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	HANDLE hProcess = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	LPVOID pAddress = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	long lTextAdr = 0, lHwndAdr = 0, lHwnd = 0, lButtonID = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	char strBuff[1024] = &amp;#123; 0 &amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	char_t *pStr = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	char *pTemp = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	// 对于Win7、Win8系统，新增了通知溢出区域，所以要检查该区域中是否有托盘图标&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	hWnd = ::FindWindow( _T(&amp;quot;NotifyIconOverflowWindow&amp;quot;), NULL );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	hWnd = ::FindWindowEx( hWnd, 0, _T(&amp;quot;ToolbarWindow32&amp;quot;), NULL );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	lRet = GetWindowThreadProcessId( hWnd, &amp;amp;ulPID );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	hProcess = OpenProcess(PROCESS_ALL_ACCESS|PROCESS_VM_OPERATION|PROCESS_VM_READ|PROCESS_VM_WRITE, 0, ulPID );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	pAddress = VirtualAllocEx( hProcess, 0, 0x4096, MEM_COMMIT, PAGE_READWRITE );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	lButtons = ::SendMessage( hWnd, TB_BUTTONCOUNT, 0, 0 );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	if (IsWow64ProcessEx(hProcess))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		EnumIcons&amp;lt;TBBUTTON64, TRAYDATA64&amp;gt;(lButtons, hProcess, pAddress, hWnd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	else&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		EnumIcons&amp;lt;TBBUTTON, TRAYDATA32&amp;gt;(lButtons, hProcess, pAddress, hWnd);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	VirtualFreeEx( hProcess, pAddress, 0X4096, MEM_RELEASE );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	CloseHandle( hProcess );&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	return FALSE;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;参考资料：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://forums.codeguru.com/showthread.php?306661-How-to-always-show-an-icon-in-system-tray&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://forums.codeguru.com/showthread.php?306661-How-to-always-show-an-icon-in-system-tray&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://bbs.csdn.net/topics/390877496&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://bbs.csdn.net/topics/390877496&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://bbs.csdn.net/topics/80237414&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://bbs.csdn.net/topics/80237414&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/wzsy/article/details/47980317&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/wzsy/article/details/47980317&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.cnblogs.com/croot/p/3496576.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://www.cnblogs.com/croot/p/3496576.html&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;由于业务需要，研究一下如何用程序判断右下角拖盘中某图标在什么时候隐藏到溢出区。经过多方资料查找，最终输出可用代码。支持windows xp至windows 10的32位和64位下的图标检测。&lt;/p&gt;
&lt;p&gt;32位程序中读取64位explorer进程中的信息时，网上大多只给出了32位的结构体定义，所以根据调试时查看内存分布，调整了下64位的结构体。&lt;/p&gt;
&lt;p&gt;代码如下：&lt;br&gt;
    
    </summary>
    
      <category term="windows" scheme="http://baba.zhaoxiuyuan.com/categories/windows/"/>
    
    
      <category term="windows" scheme="http://baba.zhaoxiuyuan.com/tags/windows/"/>
    
      <category term="shell" scheme="http://baba.zhaoxiuyuan.com/tags/shell/"/>
    
  </entry>
  
  <entry>
    <title>我的世界服务器玩家UUID生成规则</title>
    <link href="http://baba.zhaoxiuyuan.com/2016/10/105_MC%E7%94%A8%E6%88%B7%E7%9A%84UUID%E7%94%9F%E6%88%90%E8%A7%84%E5%88%99/"/>
    <id>http://baba.zhaoxiuyuan.com/2016/10/105_MC用户的UUID生成规则/</id>
    <published>2016-10-10T04:20:28.000Z</published>
    <updated>2017-03-07T02:39:16.951Z</updated>
    
    <content type="html">&lt;p&gt;由于业务需要，研究一下如何将离线版(盗版)minecraft服务器的玩家数据迁移到在线版我的世界服务器上去。&lt;/p&gt;
&lt;p&gt;查看minecraft的服务器代码(反编译)，如果是在线模式就连接用户验证服务器去获取玩家的uuid，否则就根据规则自动生成。&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;//代码片断from: net.minecraft.server.NameReferencingFileConverter&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;if (minecraftserver.getOnlineMode() || org.spigotmc.SpigotConfig.bungee) &amp;#123; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // Spigot: bungee = online mode, for now.&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    minecraftserver.getGameProfileRepository().findProfilesByNames(astring, Agent.MINECRAFT, profilelookupcallback);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125; else &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    String[] astring1 = astring;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    int i = astring.length;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    for (int j = 0; j &amp;lt; i; ++j) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        String s = astring1[j];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        UUID uuid = EntityHuman.a(new GameProfile((UUID) null, s));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        GameProfile gameprofile = new GameProfile(uuid, s);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        profilelookupcallback.onProfileLookupSucceeded(gameprofile);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;//from：net.minecraft.server.EntityHuman&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public static UUID a(GameProfile gameprofile) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    UUID uuid = gameprofile.getId();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (uuid == null) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        uuid = b(gameprofile.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return uuid;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public static UUID b(String s) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return UUID.nameUUIDFromBytes((&amp;quot;OfflinePlayer:&amp;quot; + s).getBytes(Charsets.UTF_8));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;生成算法是在用户昵称前面加上“OfflinePlayer:”后使用java函数nameUUIDFromBytes来生成。&lt;/p&gt;
&lt;p&gt;nameUUIDFromBytes函数代码如下：&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;// from: java.util.UUID.java&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;public static UUID nameUUIDFromBytes(byte[] name) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    MessageDigest md;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    try &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        md = MessageDigest.getInstance(&amp;quot;MD5&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125; catch (NoSuchAlgorithmException nsae) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        throw new InternalError(&amp;quot;MD5 not supported&amp;quot;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    byte[] md5Bytes = md.digest(name);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    md5Bytes[6]  &amp;amp;= 0x0f;  /* clear version        */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    md5Bytes[6]  |= 0x30;  /* set to version 3     */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    md5Bytes[8]  &amp;amp;= 0x3f;  /* clear variant        */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    md5Bytes[8]  |= 0x80;  /* set to IETF variant  */&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    return new UUID(md5Bytes);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;1、计算出MD5    &lt;/p&gt;
&lt;p&gt;&lt;code&gt;OfflinePlayer:k1988&lt;/code&gt; -&amp;gt; MD5: &lt;code&gt;08D699BB6400555E581B678C9441FA75&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;2、MD5的值和生成的uuid文件名对比&lt;/p&gt;
&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;08d699bb-6400-555e-581b-678c9441fa75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;08d699bb-6400-355e-981b-678c9441fa75&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;p&gt;== 解析法 ==&lt;/p&gt;
&lt;p&gt;还有一种方法就是枚举minecraft服务器中的world\playerdata目录，这个目录下每个文件对应着一个玩家，文件名(不含后缀)就是一个玩家的uuid，文件使用NBT方式储存着一些用户信息，包括用户上一次使用的昵称(可见，在线版服务器是方便更改昵称的)，及其它信息。&lt;/p&gt;
&lt;p&gt;我fork了一个NBT解析的python代码，并在里面添加了一个python脚本用来枚举playerdata下的所有文件，fork后的代码在&lt;a href=&quot;https://github.com/k1988/NBT&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://github.com/k1988/NBT&lt;/a&gt; ，脚本在examples/player_print.py，使用时直接&lt;code&gt;player_print.py &amp;lt;playerdata目录路径&amp;gt;&lt;/code&gt;即可，效果如下图：&lt;br&gt;&lt;img title=&quot;截图&quot; alt=&quot;截图&quot; src=&quot;http://o9tn2674s.bkt.clouddn.com/static/images/105_1.png-k1988&quot;&gt; &lt;/p&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;由于业务需要，研究一下如何将离线版(盗版)minecraft服务器的玩家数据迁移到在线版我的世界服务器上去。&lt;/p&gt;
&lt;p&gt;查看minecraft的服务器代码(反编译)，如果是在线模式就连接用户验证服务器去获取玩家的uuid，否则就根据规则自动生成。&lt;br&gt;
    
    </summary>
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/categories/java/"/>
    
      <category term="minecraft" scheme="http://baba.zhaoxiuyuan.com/categories/java/minecraft/"/>
    
    
      <category term="minecraft" scheme="http://baba.zhaoxiuyuan.com/tags/minecraft/"/>
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>IE控件在flash跨域时回调接口无效的问题研究</title>
    <link href="http://baba.zhaoxiuyuan.com/2016/09/104_IE%E6%8E%A7%E4%BB%B6%E5%9C%A8flash%E8%B7%A8%E5%9F%9F%E6%97%B6%E5%9B%9E%E8%B0%83%E6%8E%A5%E5%8F%A3%E6%97%A0%E6%95%88/"/>
    <id>http://baba.zhaoxiuyuan.com/2016/09/104_IE控件在flash跨域时回调接口无效/</id>
    <published>2016-09-22T05:58:28.000Z</published>
    <updated>2017-08-04T01:19:15.946Z</updated>
    
    <content type="html">&lt;p&gt;问题是这样的，我们公司的产品《UU页游戏助手》中是使用了IE浏览器的ActiveX控件来运行网页游戏，其中创建代码是这样的：&lt;br&gt;&lt;a id=&quot;more&quot;&gt;&lt;/a&gt;&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;hr = ::CoCreateInstance(&amp;quot;&amp;#123;8856F961-340A-11D0-A96B-00C04FD705A2&amp;#125;&amp;quot;, NULL, CLSCTX_ALL, IID_IOleControl, (LPVOID*)&amp;amp;pOleControl);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; GAMEMGR_ASSERT(SUCCEEDED(hr));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (FAILED(hr) || pOleControl == NULL)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    pOleControl-&amp;gt;QueryInterface(IID_IOleObject, (LPVOID*) &amp;amp;m_pUnk);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    pOleControl-&amp;gt;Release();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (m_pUnk == NULL)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // Create the host too&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    m_pControl = new GMActiveXCtrl();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    m_pControl-&amp;gt;SetOwner(this);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // More control creation stuff&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    DWORD dwMiscStatus = 0;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    m_pUnk-&amp;gt;GetMiscStatus(DVASPECT_CONTENT, &amp;amp;dwMiscStatus);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    IOleClientSite* pOleClientSite = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    m_pControl-&amp;gt;QueryInterface(IID_IOleClientSite, (LPVOID*) &amp;amp;pOleClientSite);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    GMSafeRelease&amp;lt;IOleClientSite&amp;gt; RefOleClientSite = pOleClientSite;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    // Initialize control&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if ((dwMiscStatus &amp;amp; OLEMISC_SETCLIENTSITEFIRST) != 0)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		m_pUnk-&amp;gt;SetClientSite(pOleClientSite);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    IPersistStreamInit* pPersistStreamInit = NULL;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    m_pUnk-&amp;gt;QueryInterface(IID_IPersistStreamInit, (LPVOID*) &amp;amp;pPersistStreamInit);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (pPersistStreamInit != NULL)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        hr = pPersistStreamInit-&amp;gt;InitNew();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        pPersistStreamInit-&amp;gt;Release();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if (FAILED(hr))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		return false;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    if ((dwMiscStatus &amp;amp; OLEMISC_SETCLIENTSITEFIRST) == 0)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;		m_pUnk-&amp;gt;SetClientSite(pOleClientSite);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;	&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;在使用这个IE控件时，经常有诸多问题，很多行为和IE不一致。需要去注册表添加不同的选项，最经典和常见的问题莫过于IE兼容性的问题，需要在&lt;code&gt;HKEY_CURRENT_USER\SOFTWARE\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_BROWSER_EMULATION&lt;/code&gt;中添加注册表键来强行指定兼容版本。&lt;/p&gt;
&lt;h2 id=&quot;问题来了&quot;&gt;&lt;a href=&quot;#问题来了&quot; class=&quot;headerlink&quot; title=&quot;问题来了&quot;&gt;&lt;/a&gt;问题来了&lt;/h2&gt;&lt;p&gt;然而 在前不久和今天都有客户反映他们的 &lt;strong&gt;flash&lt;/strong&gt;广告页面（是那种打开后是个flash页面，然后 &lt;strong&gt;点击flash里的按钮/图像&lt;/strong&gt;就弹出注册登录的 &lt;strong&gt;html小浮层&lt;/strong&gt;的页面）在我们的浏览器上有问题，用户第一次打开页面能正常弹出小浮层，但后面再打开就不显示了。&lt;/p&gt;
&lt;p&gt;第一次粗略的研究下，发现清除ie缓存后再打开页面后表现正常，经过调试js也没有发现明显的问题，就让客户在请求swf的链接上添加&lt;code&gt;?t=当前时间戳&lt;/code&gt;的方式避免缓存。但今天再遇到了，就想彻底的研究下到底在什么情况下会出现这个问题。&lt;/p&gt;
&lt;p&gt;使用vs2015使用 &lt;strong&gt;脚本模式&lt;/strong&gt; 附加到我们的程序上，打开解决方案管理器进行调试。多次跟踪代码和对比发现在html这边初使化flash的流程是一样的，所以问题不是在这边。而初使化之后，无缓存的情况下点击flash，js中的函数能被调用，而有缓存的情况下点击flash，js中的函数无法被调用。&lt;/p&gt;
&lt;p&gt;在无缓存的情况下，在js函数中下断点，然后回溯堆栈，发现上层调用者是动态生成的代码”eval code”：&lt;br&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;try &amp;#123; __flash__toXML(sayHello((&amp;#123;code:1,description:&amp;quot;Parameter test&amp;quot;&amp;#125;))) ; &amp;#125; catch (e) &amp;#123; &amp;quot;&amp;lt;undefined/&amp;gt;&amp;quot;; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;&lt;/p&gt;
&lt;p&gt;因为有过一段as的编码经验，所以知道这是ie和flash生成的支持swf文件里的action script调用js的函数，那么问题来了，为什么在有缓存的情况下没有自动生成这些代码？&lt;/p&gt;
&lt;img title=&quot;堆栈截图&quot; alt=&quot;堆栈截图&quot; src=&quot;http://o9tn2674s.bkt.clouddn.com/static/images/104_1.png-k1988&quot;&gt; 
&lt;h2 id=&quot;模拟重现问题&quot;&gt;&lt;a href=&quot;#模拟重现问题&quot; class=&quot;headerlink&quot; title=&quot;模拟重现问题&quot;&gt;&lt;/a&gt;模拟重现问题&lt;/h2&gt;&lt;p&gt;由于原网页过于复杂，我首先想将这个问题用简单的代码复现，就找到了以前用来测试actionscript和js交互时制作的demo，将其直接布署在我的本地测试机器上。&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;我以ip访问测试页面，多次刷新页面，再点击flash按钮，可以正常工作。&lt;/li&gt;
&lt;li&gt;对比发现广告页面是动态插入的flash，于是将demo改成动态插入，但还是无异常。 &lt;/li&gt;
&lt;li&gt;绑定个域名到本机，然后使用域名访问，多次刷新后点击，可以正常工作。&lt;/li&gt;
&lt;li&gt;将swf放在另一个域名，然后多次刷新后点击，不工作。但是这种情况，是无论有无缓存，都不正常工作。&lt;/li&gt;
&lt;li&gt;对比发现demo中的flash节点中&lt;code&gt;allowScriptAccess=&amp;quot;sameDomain&amp;quot;&lt;/code&gt;，而网页的节点属性是&lt;code&gt;allowScriptAccess=&amp;quot;always&amp;quot;&lt;/code&gt;，所以是flash属性导致的。&lt;/li&gt;
&lt;li&gt;去除该属性后再多次刷新对比，成功模拟环境。&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;在 &lt;strong&gt;IE控件&lt;/strong&gt;中打开的页面中，如果是从 &lt;strong&gt;缓存中加载的swf文件&lt;/strong&gt;，在 &lt;strong&gt;跨域&lt;/strong&gt;的情况下 &lt;strong&gt;未能正常生成&lt;/strong&gt;flash的相关 &lt;strong&gt;动态js代码&lt;/strong&gt;，导致flash中的actionscript不能调用javascript函数。&lt;/p&gt;
&lt;p&gt;但是，在ie浏览器中，无论是否从缓存中加载swf，均能正常生成动态js代码。&lt;/p&gt;
&lt;h2 id=&quot;解决问题&quot;&gt;&lt;a href=&quot;#解决问题&quot; class=&quot;headerlink&quot; title=&quot;解决问题&quot;&gt;&lt;/a&gt;解决问题&lt;/h2&gt;&lt;p&gt;尝试使用跨域文件，无效。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;未能解决此问题，留待以后继续研究吧。。&lt;/strong&gt;&lt;/p&gt;
&lt;h2 id=&quot;参考：&quot;&gt;&lt;a href=&quot;#参考：&quot; class=&quot;headerlink&quot; title=&quot;参考：&quot;&gt;&lt;/a&gt;参考：&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://stackoverflow.com/questions/30279742/webbrowser-control-and-adobe-flash-content/37503745#37503745&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://stackoverflow.com/questions/30279742/webbrowser-control-and-adobe-flash-content/37503745#37503745&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/summerhust/article/details/7721627&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://blog.csdn.net/summerhust/article/details/7721627&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;p&gt;问题是这样的，我们公司的产品《UU页游戏助手》中是使用了IE浏览器的ActiveX控件来运行网页游戏，其中创建代码是这样的：&lt;br&gt;
    
    </summary>
    
      <category term="windows" scheme="http://baba.zhaoxiuyuan.com/categories/windows/"/>
    
    
      <category term="ie" scheme="http://baba.zhaoxiuyuan.com/tags/ie/"/>
    
      <category term="flash" scheme="http://baba.zhaoxiuyuan.com/tags/flash/"/>
    
      <category term="windows" scheme="http://baba.zhaoxiuyuan.com/tags/windows/"/>
    
  </entry>
  
  <entry>
    <title>Java Annotation(Java注解)</title>
    <link href="http://baba.zhaoxiuyuan.com/2016/08/103_java%20Annotation(%E6%B3%A8%E8%A7%A3)/"/>
    <id>http://baba.zhaoxiuyuan.com/2016/08/103_java Annotation(注解)/</id>
    <published>2016-08-18T03:44:28.000Z</published>
    <updated>2016-08-18T03:46:52.995Z</updated>
    
    <content type="html">&lt;h2 id=&quot;Java注解的基础知识点&quot;&gt;&lt;a href=&quot;#Java注解的基础知识点&quot; class=&quot;headerlink&quot; title=&quot;Java注解的基础知识点&quot;&gt;&lt;/a&gt;Java注解的基础知识点&lt;/h2&gt;&lt;!--![123](./images/annotation.jpg)--&gt;
&lt;img title=&quot;Java注解的基础知识点&quot; alt=&quot;Java注解的基础知识点&quot; src=&quot;http://o9tn2674s.bkt.clouddn.com/static/images/annotation.jpg-k1988&quot;&gt; 
&lt;h2 id=&quot;参考资料&quot;&gt;&lt;a href=&quot;#参考资料&quot; class=&quot;headerlink&quot; title=&quot;参考资料&quot;&gt;&lt;/a&gt;参考资料&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://swiftlet.net/archives/1906&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;注解系列知识总结&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.cnblogs.com/peida/archive/2013/04/24/3036689.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;深入理解Java：注解（Annotation）自定义注解入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/duo2005duo/article/details/50505884&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Java注解（1）-基础&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/duo2005duo/article/details/50511476&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;Java注解（2）-运行时框架&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://blog.csdn.net/duo2005duo/article/details/50541281&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt; Java注解（3）-源码级框架&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://www.cnblogs.com/peida/archive/2013/04/24/3036689.html&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;深入理解Java：注解（Annotation）自定义注解入门&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;深入理解Java：注解（Annotation）--注解处理器&quot;&gt;深入理解Java：注解（Annotation）–注解处理器&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;Java注解的基础知识点&quot;&gt;&lt;a href=&quot;#Java注解的基础知识点&quot; class=&quot;headerlink&quot; title=&quot;Java注解的基础知识点&quot;&gt;&lt;/a&gt;Java注解的基础知识点&lt;/h2&gt;&lt;!--![123](./images/annotation.jp
    
    </summary>
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/categories/java/"/>
    
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/tags/java/"/>
    
  </entry>
  
  <entry>
    <title>minecraft联机知识点</title>
    <link href="http://baba.zhaoxiuyuan.com/2016/08/102/"/>
    <id>http://baba.zhaoxiuyuan.com/2016/08/102/</id>
    <published>2016-08-12T02:44:28.000Z</published>
    <updated>2017-08-04T01:43:59.557Z</updated>
    
    <content type="html">&lt;h1 id=&quot;配置文件&quot;&gt;&lt;a href=&quot;#配置文件&quot; class=&quot;headerlink&quot; title=&quot;配置文件&quot;&gt;&lt;/a&gt;配置文件&lt;/h1&gt;&lt;p&gt;%mc%.minecraft\servers.dat里存放着所有的服务器地址、名称、图标、介绍等信息。其中服务器地址和名称可以通过mc的主菜单-&amp;gt;多人游戏-&amp;gt;添加服务器进行添加。&lt;/p&gt;
&lt;h1 id=&quot;命令行&quot;&gt;&lt;a href=&quot;#命令行&quot; class=&quot;headerlink&quot; title=&quot;命令行&quot;&gt;&lt;/a&gt;命令行&lt;/h1&gt;&lt;p&gt;也可以通过命令行 –server mc.ymdcyy.com –port 25565 来启动mc，使之直接连接到服务器。&lt;/p&gt;
&lt;h1 id=&quot;架设服务器&quot;&gt;&lt;a href=&quot;#架设服务器&quot; class=&quot;headerlink&quot; title=&quot;架设服务器&quot;&gt;&lt;/a&gt;架设服务器&lt;/h1&gt;&lt;p&gt;通过&lt;a id=&quot;more&quot;&gt;&lt;/a&gt; &lt;a href=&quot;https://minecraft.net/en/download/server&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;https://minecraft.net/en/download/server&lt;/a&gt; 页面下载&lt;a href=&quot;https://s3.amazonaws.com/Minecraft.Download/versions/1.10/minecraft_server.1.10.jar&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;minecraft_server.1.10.jar&lt;/a&gt;,再使用命令行&lt;code&gt;java -Xmx1024M -Xms1024M -jar minecraft_server.jar nogui&lt;/code&gt;可以启动mincraft服务器。&lt;/p&gt;
&lt;p&gt;第一次启动时，会生成&lt;code&gt;eula.txt&lt;/code&gt;、&lt;code&gt;server.properties&lt;/code&gt;文件，然后报错失败。&lt;/p&gt;
&lt;p&gt;这时需要打开&lt;code&gt;eula.txt&lt;/code&gt;将&lt;code&gt;eula=false&lt;/code&gt;改为&lt;code&gt;eula=true&lt;/code&gt;表示同意协议，再次运行命令行在弹出几个错误后会建立成功服务器。这时server.properties里自动生成了一些属性，&lt;code&gt;server-port=25565&lt;/code&gt;这行就是默认使用的端口，也可以改成其它端口后重启。&lt;/p&gt;
&lt;h2 id=&quot;参数说明&quot;&gt;&lt;a href=&quot;#参数说明&quot; class=&quot;headerlink&quot; title=&quot;参数说明&quot;&gt;&lt;/a&gt;参数说明&lt;/h2&gt;&lt;figure class=&quot;highlight plain&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;#Minecraft server properties 服务器设置文件 此类型文件不支持中文，本内容仅供作为说明，true代表执行，false代表不执行&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#Sun Mar 11 18:24:34 CST 2012 此为文件生成时间&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#是否开启地狱，不开启话地狱门将无效&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;allow-nether=true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#地图文件夹名称，下界与末路之地将会自动以nether,ender加上并用下划线隔开&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;level-name=world&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#是否开启GameSpy4协议服务器监听器，用于获取服务器信息。目测国内用不上。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;enable-query=false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#是否允许飞行&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;allow-flight=false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#远程访问服务器的密码，此项可以留空或删除&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rcon.password=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#服务器端口（25565为默认端口，联机时无需输入）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server-port=25565&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#第5行对应功能的端口&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;query.port=25565&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#地图类型，Default=默认，FLAT=超平坦，LARGEBIOMES=巨型生物群系&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;level-type=DEFAULT&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#是否开启远程访问服务器控制台。技术人员可选。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;enable-rcon=false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#地图种子，在生成地图文件夹之前填入此项，可生成特定的地图&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;level-seed=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#服务器IP，不输入则为默认IP，内网用户的话请填内网IP&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;server-ip=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#最大建筑高度，上限是256，因为Chunk的高度最大值是256&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;max-build-height=256&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#是否生成NPC&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;spawn-npcs=true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#是否开启白名单，没有白名单的玩家尝试进入服务器会被自动拒绝&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;white-list=false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#是否生成动物&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;spawn-animals=true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#此处填写服务器默认材质下载链接，链接必须以.zip结尾&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;texture-pack=&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#用于给http://snoop.minecraft.net网站发送服务器数据，这样玩家可以从客户端上获取服务器信息，目测也没人看，推荐关闭&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;snooper-enabled=false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#是否开启极限模式，玩家死亡将自动被ban&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;hardcore=false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#是否开启联网模式（正版专用，盗版必改为false！！！！！！！！！）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;online-mode=false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#是否开启PVP，不是战争服就不要开了&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;pvp=false&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#游戏难度，与单机相同&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;difficulty=1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#玩家第一次进入游戏时的游戏模式&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;gamemode=0&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#同时在线的最大玩家数&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;max-players=20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#远程访问服务器的端口号，此项可以留空或删除&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;rcon.port=25575&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#是否生成怪物&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;spawn-monsters=true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#是否生成建筑物（包括村庄和地牢）&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;generate-structures=true&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#可见距离，最大值为10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;view-distance=10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;#服务器欢迎信息（显示在玩家联机页面），中文需中文补丁支持和转码（yy的补丁可用（也需要旧版服务器），ICE未知），推荐EmEditor文本编辑器，自带转码功能&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;motd=A Minecraft Server&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
&lt;h1 id=&quot;客户端ping&quot;&gt;&lt;a href=&quot;#客户端ping&quot; class=&quot;headerlink&quot; title=&quot;客户端ping&quot;&gt;&lt;/a&gt;客户端ping&lt;/h1&gt;&lt;p&gt;MC在打开网络时，会对每一个保存的服务器进行ping来获取服务器描述信息和图片文件，支持的客户端版本号及在线人数等信息，使用的协议参考&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;http://wiki.vg/Server_List_Ping&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://wiki.vg/Server_List_Ping&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;http://wiki.vg/Query&quot; target=&quot;_blank&quot; rel=&quot;external&quot;&gt;http://wiki.vg/Query&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id=&quot;测试服务器列表&quot;&gt;&lt;a href=&quot;#测试服务器列表&quot; class=&quot;headerlink&quot; title=&quot;测试服务器列表&quot;&gt;&lt;/a&gt;测试服务器列表&lt;/h1&gt;&lt;ul&gt;
&lt;li&gt;five.mengcraft.com:18233&lt;/li&gt;
&lt;li&gt;龙腾盛世 &lt;ul&gt;
&lt;li&gt;mc.ymdcyy.com:25565&lt;/li&gt;
&lt;li&gt;官网：www.ymdcyy.com&lt;/li&gt;
&lt;li&gt;版本 1.7.10&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
</content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;配置文件&quot;&gt;&lt;a href=&quot;#配置文件&quot; class=&quot;headerlink&quot; title=&quot;配置文件&quot;&gt;&lt;/a&gt;配置文件&lt;/h1&gt;&lt;p&gt;%mc%.minecraft\servers.dat里存放着所有的服务器地址、名称、图标、介绍等信息。其中服务器地址和名称可以通过mc的主菜单-&amp;gt;多人游戏-&amp;gt;添加服务器进行添加。&lt;/p&gt;
&lt;h1 id=&quot;命令行&quot;&gt;&lt;a href=&quot;#命令行&quot; class=&quot;headerlink&quot; title=&quot;命令行&quot;&gt;&lt;/a&gt;命令行&lt;/h1&gt;&lt;p&gt;也可以通过命令行 –server mc.ymdcyy.com –port 25565 来启动mc，使之直接连接到服务器。&lt;/p&gt;
&lt;h1 id=&quot;架设服务器&quot;&gt;&lt;a href=&quot;#架设服务器&quot; class=&quot;headerlink&quot; title=&quot;架设服务器&quot;&gt;&lt;/a&gt;架设服务器&lt;/h1&gt;&lt;p&gt;通过
    
    </summary>
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/categories/java/"/>
    
      <category term="minecraft" scheme="http://baba.zhaoxiuyuan.com/categories/java/minecraft/"/>
    
    
      <category term="minecraft" scheme="http://baba.zhaoxiuyuan.com/tags/minecraft/"/>
    
      <category term="java" scheme="http://baba.zhaoxiuyuan.com/tags/java/"/>
    
  </entry>
  
</feed>
